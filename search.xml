<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Zerotier异地组网</title>
      <link href="2023/create-zerotier-p2p-network/"/>
      <url>2023/create-zerotier-p2p-network/</url>
      
        <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>随着个人设备增多，nas，个人影音库等边缘计算流行。如何低成本，高效的组织，联系各个设备变成一个问题。而zerotier可以比较完美的解决这个问题。</p><p>zerotier是一个异地组网神器，相比于传统中转组网受限制于节点带宽，zerotier会优先使用p2p模式通信，这在双方同时拥有公网IP时格外有效。</p><p>相比于中转，p2p直连可以提高速率和稳定性，不受服务器带宽限制（改为收到双方上传带宽限制）</p><h3 id="搭建"><a href="#搭建" class="headerlink" title="搭建"></a>搭建</h3><h4 id="1，下载"><a href="#1，下载" class="headerlink" title="1，下载"></a>1，下载</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https://github.com/Jonnyan404/zerotier-planet</span><br><span class="line">cd zerotier-planet</span><br><span class="line">vim docker-compose.yml</span><br></pre></td></tr></table></figure><h4 id="2，修改"><a href="#2，修改" class="headerlink" title="2，修改"></a>2，修改</h4><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&#x27;2.0&#x27;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">    <span class="attr">ztncui:</span></span><br><span class="line">        <span class="attr">container_name:</span> <span class="string">ztncui</span></span><br><span class="line">        <span class="attr">restart:</span> <span class="string">always</span></span><br><span class="line">        <span class="attr">environment:</span></span><br><span class="line">            <span class="comment"># - MYADDR=公网地址(不设置该项自动获取)</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">MYADDR=127.0.0.1</span>  <span class="comment"># 改成自己的服务器公网ip</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">HTTP_PORT=3443</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">HTTP_ALL_INTERFACES=yes</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">ZTNCUI_PASSWD=root</span></span><br><span class="line">        <span class="attr">ports:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;3443:3443&#x27;</span>  <span class="comment"># 设置网页的端口</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;9993:9993&#x27;</span>  <span class="comment"># 作为中心节点，提供9993端口给客户端用，一般是9993</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;9993:9993/udp&#x27;</span></span><br><span class="line">        <span class="attr">volumes:</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;./zerotier-one:/var/lib/zerotier-one&#x27;</span></span><br><span class="line">            <span class="bullet">-</span> <span class="string">&#x27;./ztncui/etc:/opt/key-networks/ztncui/etc&#x27;</span></span><br><span class="line">            <span class="comment"># 按实际路径挂载卷， 冒号前面是宿主机的， 支持相对路径</span></span><br><span class="line">        <span class="attr">image:</span> <span class="string">keynetworks/ztncui</span></span><br></pre></td></tr></table></figure><h4 id="3，运行"><a href="#3，运行" class="headerlink" title="3，运行"></a>3，运行</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br><span class="line"></span><br><span class="line">docker images #　查看镜像</span><br><span class="line">docker container ps -a # 查看容器</span><br></pre></td></tr></table></figure><h4 id="4，配置"><a href="#4，配置" class="headerlink" title="4，配置"></a>4，配置</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it ztncui bash # 进入容器</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器内操作</span></span><br><span class="line">cd /var/lib/zerotier-one</span><br><span class="line">ls -l</span><br><span class="line"><span class="meta">#</span><span class="bash"> 生成moon配置文件</span></span><br><span class="line">zerotier-idtool initmoon identity.public &gt; moon.json</span><br><span class="line">chmod 777 moon.json</span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改stableEndpoints, 注意格式和实际公网ip</span></span><br><span class="line">&#123;</span><br><span class="line"> &quot;id&quot;: &quot;b72b5e9e1a&quot;,</span><br><span class="line"> &quot;objtype&quot;: &quot;world&quot;,</span><br><span class="line"> &quot;roots&quot;: [</span><br><span class="line">  &#123;</span><br><span class="line">   &quot;identity&quot;: &quot;b72b5e9e1a:0:a892e51d2ef94ef941e4c499af01fbc2903f7ad2fd53e9370f9ac6260c2f5d2484fd90756bec0c410675a81b7cf61d2bb885783bd6a8c28bce83bcab5f03fe14&quot;,</span><br><span class="line">   &quot;stableEndpoints&quot;: [&quot;127.0.0.1/9993&quot;]</span><br><span class="line">  &#125;</span><br><span class="line"> ],</span><br><span class="line"> &quot;signingKey&quot;: &quot;45f0613e569a0549c74293c39b30495b594a003534290e8ade9ef82877aa7505d7a73eeabfc22c97c404e4caaf9f3c9eed2b134d696935c966e28f523364f15f&quot;,</span><br><span class="line"> &quot;signingKey_SECRET&quot;: &quot;cc6afd67e7b7f84a92e2c8d3c2e7212c71e2ad0a4f5b3c03bf60ab1cd3b99281b57d9a2958d2bd8fc2bc77fdf2a1160099c2c61d3d9acc8cb311673ee120b4a6&quot;,</span><br><span class="line"> &quot;updatesMustBeSignedBy&quot;: &quot;45f0613e569a0549c74293c39b30495b594a003534290e8ade9ef82877aa7505d7a73eeabfc22c97c404e4caaf9f3c9eed2b134d696935c966e28f523364f15f&quot;,</span><br><span class="line"> &quot;worldType&quot;: &quot;moon&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器内生成moon文件</span></span><br><span class="line">zerotier-idtool genmoon moon.json</span><br><span class="line">mkdir moons.d</span><br><span class="line">cp *.moon moons.d/</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器外生成planet文件</span></span><br><span class="line">mv world.bin planet</span><br><span class="line"><span class="meta">#</span><span class="bash"> 复制到容器内</span></span><br><span class="line">docker cp ./planet ztncui:/var/lib/zerotier-one</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启容器</span></span><br><span class="line">docker restart ztncui</span><br></pre></td></tr></table></figure><h4 id="5，验证-amp-授权"><a href="#5，验证-amp-授权" class="headerlink" title="5，验证 &amp; 授权"></a>5，验证 &amp; 授权</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it ztncui bash # 进入容器</span><br><span class="line"><span class="meta">#</span><span class="bash"> 在容器内操作</span></span><br><span class="line">cd /var/lib/zerotier-one</span><br><span class="line"><span class="meta">#</span><span class="bash">　查看ｍoon</span></span><br><span class="line">zerotier-cli listmoons</span><br><span class="line"><span class="meta">#</span><span class="bash"> 访问ip+端口对应的设置页面</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 替换客户端的planet文件并重启服务， 再加入网络， 在网页端授权</span></span><br></pre></td></tr></table></figure><h3 id="客户端"><a href="#客户端" class="headerlink" title="客户端"></a>客户端</h3><h4 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h4><p>下载地址：<a href="https://www.zerotier.com/download/">Zerotier Download</a></p><p>点自动安装后，默认会在任务栏启动，需要在右下角找到zerotierUI点击 Quit 退出</p><ol><li>停止Zerotier任务</li></ol><p>任务管理器，找到zerotier服务退出</p><div align="center">    <img src="https://cdn.lucat.fun/blog/2024-01/c5081eba803b112e00300c2aea68c6aa.png-w" width="80%"/></div><ol start="2"><li>替换planet文件</li></ol><p>打开<code>C:\ProgramData\ZeroTier\One</code>，用刚刚下载的planet替换掉本地的planet</p><div align="center">    <img src="https://cdn.lucat.fun/blog/2024-01/b147bd186f818eca6c003aa2dc32d18e.png-w" width="80%"/></div><ol start="3"><li>重启Zerotier服务</li></ol><p>在任务管理器点击重新启动Zerotier服务，等已停止变成正在运行</p><ol start="4"><li>连接私有网络</li></ol><p>在右下角任务栏找到ZerotierUI，依次 <code>右键</code> - <code>join New Network</code>，输入网络ID</p><ol start="5"><li>在服务端界面，给本地客户端授权</li></ol><p>在客户端查看状态OK表示连接成功。</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
    </entry>
    
    
    
    <entry>
      <title>OpenSSL使用中继证书签发业务证书【兼容IOS设备】</title>
      <link href="2022/sign-certificate/"/>
      <url>2022/sign-certificate/</url>
      
        <content type="html"><![CDATA[<p>按照网上教程折腾一翻，发现签发的证书无法在IOS设备上信任，本篇总结了折腾的经过。</p><h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><p>随着nas兴起，在搭建了plex，zerotier众多服务后，需要一个nginx代理整体内网流量。虽然有三个月免费的泛域名，但是来来回回挺麻烦的，不如直接自签一个</p><p>之前研究过自签证书，出现过ios这边证书有问题，但是其他环境没问题的情况。</p><p>这里也是想给nginx创建一个，踩坑整理一下。</p><div align="center">    <img src="https://cdn.lucat.fun/blog/2022-09/U4MQSM-KTptls.png-w" width="80%"/></div><h3 id="信息及需求梳理"><a href="#信息及需求梳理" class="headerlink" title="信息及需求梳理"></a>信息及需求梳理</h3><h4 id="结构"><a href="#结构" class="headerlink" title="结构"></a>结构</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 根证书(发给手机等电脑信任一下)  -&gt;  中继证书(一般负责一整块业务)  -&gt;  业务证书 (具体服务，我这里是nginx)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> rootCA  -&gt;  cloudCA  -&gt;  nginx service</span></span><br></pre></td></tr></table></figure><h4 id="有效期"><a href="#有效期" class="headerlink" title="有效期"></a>有效期</h4><ul><li>根证书：100年</li><li>中继证书：10年</li><li>业务证书：824天 </li></ul><p>因为给nginx签的，太长浏览器会报错，如果是后端服务用长一点应该没事</p><h3 id="签发证书"><a href="#签发证书" class="headerlink" title="签发证书"></a>签发证书</h3><h4 id="1-创建工作目录"><a href="#1-创建工作目录" class="headerlink" title="1.创建工作目录"></a>1.创建工作目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 老样子，创建本次工作目录，防止与其他文件冲突</span></span><br><span class="line"><span class="built_in">cd</span> ~ &amp;&amp; mkdir ssl &amp;&amp; <span class="built_in">cd</span> ssl</span><br></pre></td></tr></table></figure><h4 id="2-生成各级配置文件"><a href="#2-生成各级配置文件" class="headerlink" title="2.生成各级配置文件"></a>2.生成各级配置文件</h4><p>注意改组织名和最后业务证书的IP地址，域名</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 根证书配置文件</span></span><br><span class="line">cat &gt; rootCA.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[ req ]</span></span><br><span class="line"><span class="string">default_bits        = 4096</span></span><br><span class="line"><span class="string">distinguished_name  = req_distinguished_name</span></span><br><span class="line"><span class="string">req_extensions      = SAN</span></span><br><span class="line"><span class="string">extensions          = SAN</span></span><br><span class="line"><span class="string">[ req_distinguished_name ]</span></span><br><span class="line"><span class="string">countryName             = CN</span></span><br><span class="line"><span class="string">stateOrProvinceName = Beijing</span></span><br><span class="line"><span class="string">localityName = Beijing</span></span><br><span class="line"><span class="string">0.organizationName  = LiYao&#x27;s House</span></span><br><span class="line"><span class="string">organizationalUnitName      = LiYao&#x27;s Private Service</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[SAN]</span></span><br><span class="line"><span class="string">extendedKeyUsage    = serverAuth</span></span><br><span class="line"><span class="string">basicConstraints=CA:TRUE,pathlen:2</span></span><br><span class="line"><span class="string">subjectKeyIdentifier=hash</span></span><br><span class="line"><span class="string">authorityKeyIdentifier=keyid:always,issuer:always</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 中继证书配置文件</span></span><br><span class="line">cat &gt; cloud.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">authorityKeyIdentifier=keyid,issuer</span></span><br><span class="line"><span class="string">basicConstraints=CA:FALSE</span></span><br><span class="line"><span class="string">keyUsage=digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span></span><br><span class="line"><span class="string">subjectAltName=@alt_names</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ req ]</span></span><br><span class="line"><span class="string">default_bits = 2048</span></span><br><span class="line"><span class="string">distinguished_name = req_distinguished_name</span></span><br><span class="line"><span class="string">req_extensions = SAN</span></span><br><span class="line"><span class="string">extensions = SAN</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ req_distinguished_name ]</span></span><br><span class="line"><span class="string">countryName = CN</span></span><br><span class="line"><span class="string">stateOrProvinceName = Beijing</span></span><br><span class="line"><span class="string">localityName = Beijing</span></span><br><span class="line"><span class="string">0.organizationName  = LiYao&#x27;s Private Service</span></span><br><span class="line"><span class="string">organizationalUnitName      = LiYao&#x27;s Cloud Dept</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[SAN]</span></span><br><span class="line"><span class="string">extendedKeyUsage = serverAuth</span></span><br><span class="line"><span class="string">basicConstraints=CA:TRUE,pathlen:0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[v3_new]</span></span><br><span class="line"><span class="string">extendedKeyUsage = serverAuth</span></span><br><span class="line"><span class="string">EOF</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 业务证书</span></span><br><span class="line">cat &gt; nginx.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[ req ]</span></span><br><span class="line"><span class="string">default_bits        = 4096</span></span><br><span class="line"><span class="string">distinguished_name  = req_distinguished_name</span></span><br><span class="line"><span class="string">req_extensions      = SAN</span></span><br><span class="line"><span class="string">extensions          = SAN</span></span><br><span class="line"><span class="string">[ req_distinguished_name ]</span></span><br><span class="line"><span class="string">countryName             = CN</span></span><br><span class="line"><span class="string">stateOrProvinceName = Beijing</span></span><br><span class="line"><span class="string">localityName = Beijing</span></span><br><span class="line"><span class="string">0.organizationName  = LiYao&#x27;s Cloud Dept</span></span><br><span class="line"><span class="string">organizationalUnitName      = LiYao&#x27;s Nginx Service</span></span><br><span class="line"><span class="string">[ alternate_names ]</span></span><br><span class="line"><span class="string">DNS.1 = localhost</span></span><br><span class="line"><span class="string">IP.1   = 192.168.1.1</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[SAN]</span></span><br><span class="line"><span class="string">subjectAltName      = @alternate_names</span></span><br><span class="line"><span class="string">extendedKeyUsage    = serverAuth</span></span><br><span class="line"><span class="string">basicConstraints=CA:FALSE,pathlen:0</span></span><br><span class="line"><span class="string">subjectKeyIdentifier=hash</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><h4 id="3-生成key文件"><a href="#3-生成key文件" class="headerlink" title="3.生成key文件"></a>3.生成key文件</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># openssl生成key，2048已经不安全，改为4096</span></span><br><span class="line">openssl genrsa -out rootCA.key 4096</span><br><span class="line">openssl genrsa -out cloud.key 4096</span><br><span class="line">openssl genrsa -out nginx.key 4096</span><br></pre></td></tr></table></figure><h4 id="4-生成根证书"><a href="#4-生成根证书" class="headerlink" title="4.生成根证书"></a>4.生成根证书</h4><p>subj内容改成自己的</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">openssl req \</span><br><span class="line">-newkey rsa:4096 \</span><br><span class="line">-x509 \</span><br><span class="line">-nodes \</span><br><span class="line">-keyout rootCA.key \</span><br><span class="line">-new \</span><br><span class="line">-out rootCA.pem \</span><br><span class="line">-subj &quot;/emailAddress=liyao@lucat.fun/CN=LiYao&#x27;s Root CA./C=CN/ST=Beijing/L=Beijing/O=LiYao&#x27;s House/OU=LiYao&#x27;s Private Service&quot; \</span><br><span class="line">-config ./rootCA.cnf \</span><br><span class="line">-reqexts SAN \</span><br><span class="line">-extensions SAN \</span><br><span class="line">-sha256 \</span><br><span class="line">-days 36500</span><br></pre></td></tr></table></figure><h4 id="5-生成中继证书csr及签发中继证书"><a href="#5-生成中继证书csr及签发中继证书" class="headerlink" title="5.生成中继证书csr及签发中继证书"></a>5.生成中继证书csr及签发中继证书</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -sha256 \</span><br><span class="line">-key cloud.key \</span><br><span class="line">-subj <span class="string">&quot;/emailAddress=liyao@lucat.fun/CN=LiYao&#x27;s Cloud CA./C=CN/ST=Beijing/L=Beijing/O=LiYao&#x27;s Private Service/OU=LiYao&#x27;s Cloud Dept&quot;</span> \</span><br><span class="line">-config ./cloud.cnf \</span><br><span class="line">-reqexts SAN \</span><br><span class="line">-extensions SAN \</span><br><span class="line">-sha256 \</span><br><span class="line">-out cloud.csr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">openssl x509 -req \</span><br><span class="line">-<span class="keyword">in</span> cloud.csr -CA rootCA.pem -CAkey rootCA.key \</span><br><span class="line">-out cloud.pem \</span><br><span class="line">-CAcreateserial  \</span><br><span class="line">-days 3650 \</span><br><span class="line">-sha256 \</span><br><span class="line">-extensions SAN \</span><br><span class="line">-extfile cloud.cnf</span><br></pre></td></tr></table></figure><h4 id="6-生成业务证书csr及签发业务证书"><a href="#6-生成业务证书csr及签发业务证书" class="headerlink" title="6.生成业务证书csr及签发业务证书"></a>6.生成业务证书csr及签发业务证书</h4><p>这里，如果是给web使用的话，证书签发的时间不能超过825天，否则chrome或safari会提示证书不信任：<code>NET::ERR_CERT_VALIDITY_TOO_LONG</code>，意思证书时间过长。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -sha256 \</span><br><span class="line">-key nginx.key \</span><br><span class="line">-subj <span class="string">&quot;/emailAddress=liyao@lucat.fun/CN=LiYao&#x27;s Nginx Service./C=CN/ST=Beijing/L=Beijing/O=LiYao&#x27;s Cloud Dept/OU=LiYao&#x27;s Nginx Service&quot;</span> \</span><br><span class="line">-config ./nginx.cnf \</span><br><span class="line">-reqexts SAN \</span><br><span class="line">-extensions SAN \</span><br><span class="line">-sha256 \</span><br><span class="line">-out nginx.csr</span><br><span class="line"></span><br><span class="line">openssl x509 -req \</span><br><span class="line">-<span class="keyword">in</span> nginx.csr -CA cloud.pem -CAkey cloud.key \</span><br><span class="line">-out nginx.pem \</span><br><span class="line">-CAcreateserial  \</span><br><span class="line">-days 824 \</span><br><span class="line">-sha256 \</span><br><span class="line">-extensions SAN \</span><br><span class="line">-extfile nginx.cnf</span><br></pre></td></tr></table></figure><h3 id="MacOS配置"><a href="#MacOS配置" class="headerlink" title="MacOS配置"></a>MacOS配置</h3><p>执行<code>open .</code> 打开ssl目录，双击<code>rootCA.pem</code>安装根证书，双击修改证书信任策略为<code>始终信任</code></p><div align="center">    <img src="https://cdn.lucat.fun/blog/2021-03/ilo2-FmlOWy.png-w" width="80%"/></div><p>退出浏览器重新打开，锁则变为绿色</p><h3 id="Iphone设置"><a href="#Iphone设置" class="headerlink" title="Iphone设置"></a>Iphone设置</h3><p>使用隔空投送，将<code>rootCA.pem</code>推送至手机，用QQ，微信好像不行，不支持打开。</p><ol><li>打开系统设置，点击添加提示，信任描述文件。</li><li>通用，关于本机下滑到底，证书信任设置中开启对证书的信任。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 证书 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RBAC下DRF基于权限码的整体权限设计</title>
      <link href="2021/django-restframework-method-permission/"/>
      <url>2021/django-restframework-method-permission/</url>
      
        <content type="html"><![CDATA[<h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>利用Django+Rest Framework 可以很轻松的专注于API开发，而不必重复造一些轮子。针对API的权限设计是整个系统核心且无比重要的步骤，DRF框架内置的一些权限如下。</p><table><thead><tr><th>权限名称</th><th>描述</th></tr></thead><tbody><tr><td>AllowAny</td><td>允许全部请求访问</td></tr><tr><td>IsAuthenticated</td><td>允许认证账户访问</td></tr><tr><td>IsAdminUser</td><td>允许管理员访问</td></tr><tr><td>IsAuthenticatedOrReadOnly</td><td>允许认证账户访问全部的基础上，允许匿名用户执行GET, HEAD 或 OPTIONS</td></tr><tr><td>DjangoModelPermissions</td><td>基于DjangoModel的权限访问</td></tr><tr><td>DjangoModelPermissionsOrAnonReadOnly</td><td>基于DjangoModel的权限访问的基础上，允许匿名用户执行GET, HEAD 或 OPTIONS</td></tr><tr><td>DjangoObjectPermissions</td><td>Django的标准对象权限框架相关联，对象级权限</td></tr></tbody></table><p>可以看出，除了一些基本的权限外，DRF精细化权限设计基本都是基于model来做的，这样不好的地方是每次权限的变化都需要发生代码层面的修改。</p><p>更重要的是在RBAC中，我们更希望权限是绑定在角色上，脱离数据。</p><h3 id="设计思路"><a href="#设计思路" class="headerlink" title="设计思路"></a>设计思路</h3><p>我们希望改动能兼顾到以下几个点：</p><ol><li>授权，修改，增删改等完全脱离于代码，全部动态可控。</li><li>权限精细到url的某个方法。如：get, post, delete等。</li><li>配置方便，代码入侵小，很方便的迁移。</li></ol><p>很优秀的地方是，Django Rest Framework允许我们自定义权限。加上一些配合性的改动，可以很轻松的实现上述的要求。</p><h3 id="最佳实现"><a href="#最佳实现" class="headerlink" title="最佳实现"></a>最佳实现</h3><h4 id="1-权限体系梳理"><a href="#1-权限体系梳理" class="headerlink" title="1.权限体系梳理"></a>1.权限体系梳理</h4><p>在RBAC体系下，我们针对的是角色授权。举例，在我自行实现的框架中，权限是以权限码(<code>PermissionCode</code>)的形式关联到角色上。</p><p>前端在登录后获取用户token，并请求加载菜单，权限码等必要信息。根据权限码来决定某些菜单或者按钮是否要展示。</p><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取权限码</span></span><br><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">getPermCodeByUserId</span>(<span class="params">params: GetUserInfoByUserIdParams</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> defHttp.get&lt;<span class="built_in">string</span>[]&gt;(&#123;</span><br><span class="line">    url: Api.GetPermCodeByUserId + params.userId + <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    params,</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--决定某些按钮是否显示--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">template</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">a-button</span> <span class="attr">v-if</span>=<span class="string">&quot;hasPermission([&#x27;20000&#x27;, &#x27;2000010&#x27;])&quot;</span> <span class="attr">color</span>=<span class="string">&quot;error&quot;</span> <span class="attr">class</span>=<span class="string">&quot;mx-4&quot;</span>&gt;</span></span><br><span class="line">    拥有[20000,2000010]code可见</span><br><span class="line">  <span class="tag">&lt;/<span class="name">a-button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">template</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">lang</span>=<span class="string">&quot;ts&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; usePermission &#125; <span class="keyword">from</span> <span class="string">&#x27;/@/hooks/web/usePermission&#x27;</span>;</span></span><br><span class="line"><span class="javascript">  <span class="keyword">import</span> &#123; RoleEnum &#125; <span class="keyword">from</span> <span class="string">&#x27;/@/enums/roleEnum&#x27;</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">  <span class="keyword">export</span> <span class="keyword">default</span> defineComponent(&#123;</span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="title">setup</span>(<span class="params"></span>)</span> &#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">const</span> &#123; hasPermission &#125; = usePermission();</span></span><br><span class="line"><span class="javascript">      <span class="keyword">return</span> &#123; hasPermission &#125;;</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><div align="center">    <img src="https://cdn.lucat.fun/blog/2021-07/kBhr2X-7k5oUd.png-w" width="80%"/></div><p>所以关键点是如何将现有的权限码关联到我们的方法上</p><h4 id="2-后端实现"><a href="#2-后端实现" class="headerlink" title="2.后端实现"></a>2.后端实现</h4><p>以权限码为基础，后端的改造大致分为两个部分：</p><ol><li>对<code>ApiView</code> 的改造，基于原有的方法拓展自定义的权限属性.</li><li>增加DRF自定义权限，针对我们自定义的权限属性进行验证。</li></ol><p>针对<code>ApiView</code> 的改动较为简单</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework.views <span class="keyword">import</span> APIView</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PermissionAPIView</span>(<span class="params">APIView</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        基于ApiView封装的权限视图，支持设置方法级权限。</span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">        :permission_code 权限码（基于角色的权限Code）, 格式为数字或数字组成的列表</span></span><br><span class="line"><span class="string">        :permission_code_by_action 方法级权限码设置，格式为字典嵌套方法名，如&#123;&#x27;get&#x27;: [100, 200]&#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    permission_code = []</span><br><span class="line">    permission_code_by_method = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init_subclass__</span>(<span class="params">cls, **kwargs</span>):</span></span><br><span class="line">        <span class="comment"># 预检查配置及部分易出错场景</span></span><br><span class="line">        PermissionAPIView.pre_check(cls)</span><br><span class="line">        <span class="comment"># 初始化类并注册</span></span><br><span class="line">        <span class="built_in">super</span>().__init_subclass__(**kwargs)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pre_check</span>(<span class="params">cls</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;针对传入的cls检查permission_code等参数是否符合格式要求&quot;&quot;&quot;</span></span><br><span class="line">        <span class="comment"># AnonymousUser无法使用PermissionCode进行检查</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="keyword">not</span> cls.permission_code <span class="keyword">and</span> <span class="keyword">not</span> cls.permission_code_by_method <span class="keyword">or</span> cls.authentication_classes, \</span><br><span class="line">            <span class="string">&#x27;PermissionAPIView cannot be used in AnonymousUser, please check class: %s&#x27;</span> % cls.__name__</span><br></pre></td></tr></table></figure><p>这里我们封装了两个属性，<code>permission_code</code>，<code>permission_code_by_action</code>。</p><p>权限支持Int和List格式，分别对应单个和多个。基于method的权限是字典格式，支持设置<code>get</code>, <code>post</code>等key，value和单个权限格式一致，支持Int和List格式。</p><p>自定义权限设置较为复杂，因为其包含了格式检查等多个操作</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> permissions</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CodePermission</span>(<span class="params">permissions.BasePermission</span>):</span></span><br><span class="line">    REQUEST_METHOD_MAP = &#123;</span><br><span class="line">        <span class="string">&#x27;list&#x27;</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;create&#x27;</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;destroy&#x27;</span>: <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;delete&#x27;</span>: <span class="string">&#x27;DELETE&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;retrieve&#x27;</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;put&#x27;</span>: <span class="string">&#x27;PUT&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;get&#x27;</span>: <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;post&#x27;</span>: <span class="string">&#x27;POST&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;patch&#x27;</span>: <span class="string">&#x27;PATCH&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">check_permission_format</span>(<span class="params">self, permission_code, permission_code_by_method, view</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;检查配置的权限是否合法，不满足格式要求会抛异常&quot;&quot;&quot;</span></span><br><span class="line">        module_path = <span class="string">&quot;&#123;&#125;.&#123;&#125;&quot;</span>.<span class="built_in">format</span>(view.__module__, view.__name__)</span><br><span class="line">        <span class="keyword">if</span> permission_code <span class="keyword">and</span> permission_code <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(permission_code, (<span class="built_in">int</span>, <span class="built_in">list</span>)):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(</span><br><span class="line">                <span class="string">&#x27;&lt;%s&gt; permission_code type was not int or list&#x27;</span> % module_path</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(permission_code, <span class="built_in">list</span>):</span><br><span class="line">                <span class="keyword">for</span> action_code <span class="keyword">in</span> permission_code:</span><br><span class="line">                    <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(action_code, <span class="built_in">int</span>):</span><br><span class="line">                        <span class="keyword">raise</span> TypeError(</span><br><span class="line">                            <span class="string">&#x27;&lt;%s&gt; permission_code list value &quot;%s&quot; type was not int!&#x27;</span> % (module_path, action_code)</span><br><span class="line">                        )</span><br><span class="line">        <span class="keyword">if</span> permission_code_by_method <span class="keyword">and</span> permission_code_by_method <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="string">&quot;&quot;&quot;&quot;&quot;&quot;</span></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(permission_code_by_method, <span class="built_in">dict</span>):</span><br><span class="line">                <span class="keyword">raise</span> TypeError(</span><br><span class="line">                    <span class="string">&#x27;&lt;%s&gt; permission_code_by_method type must dict!&#x27;</span> % module_path</span><br><span class="line">                )</span><br><span class="line">            <span class="keyword">for</span> action <span class="keyword">in</span> permission_code_by_method:</span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">str</span>(action).lower() <span class="keyword">not</span> <span class="keyword">in</span> self.REQUEST_METHOD_MAP:</span><br><span class="line">                    <span class="keyword">raise</span> TypeError(</span><br><span class="line">                        <span class="string">&#x27;&lt;%s&gt; permission_code_by_method: action &quot;%s&quot; not support, allow:[%s]&#x27;</span> % (</span><br><span class="line">                            module_path, action, <span class="string">&quot;,&quot;</span>.join(self.REQUEST_METHOD_MAP.keys())</span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">hasattr</span>(view, action):</span><br><span class="line">                    <span class="keyword">raise</span> AttributeError(</span><br><span class="line">                        <span class="string">&#x27;&lt;%s&gt; permission_code_by_method: method &quot;%s&quot; is undefined in this class.&#x27;</span> % (</span><br><span class="line">                            module_path, action</span><br><span class="line">                        )</span><br><span class="line">                    )</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(permission_code_by_method.get(action, <span class="literal">None</span>), (<span class="built_in">int</span>, <span class="built_in">list</span>)):</span><br><span class="line">                    <span class="keyword">raise</span> TypeError(</span><br><span class="line">                        <span class="string">&#x27;&lt;%s&gt; permission_code_by_method: &quot;%s&quot; permission_code type must int or list, not %s.&#x27;</span></span><br><span class="line">                        % (module_path, action, <span class="built_in">type</span>(permission_code_by_method.get(action, <span class="literal">None</span>)).__name__)</span><br><span class="line">                    )</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">isinstance</span>(action_list := permission_code_by_method.get(action, <span class="literal">None</span>), <span class="built_in">list</span>):</span><br><span class="line">                        <span class="keyword">for</span> action_code <span class="keyword">in</span> action_list:</span><br><span class="line">                            <span class="keyword">if</span> <span class="keyword">not</span> <span class="built_in">isinstance</span>(action_code, <span class="built_in">int</span>):</span><br><span class="line">                                <span class="keyword">raise</span> TypeError(</span><br><span class="line">                                    <span class="string">&#x27;&lt;%s&gt; permission_code_by_method: &quot;%s&quot; code list value &quot;%s&quot; type was not int&#x27;</span> % (</span><br><span class="line">                                        module_path, action, action_code</span><br><span class="line">                                    )</span><br><span class="line">                                )</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_permission</span>(<span class="params">self, view</span>) -&gt; tuple:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;获取配置的权限&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">getattr</span>(view, <span class="string">&#x27;permission_code&#x27;</span>) <span class="keyword">if</span> <span class="built_in">hasattr</span>(view, <span class="string">&#x27;permission_code&#x27;</span>) <span class="keyword">else</span> <span class="literal">None</span>, \</span><br><span class="line">               <span class="built_in">getattr</span>(view, <span class="string">&#x27;permission_code_by_method&#x27;</span>) <span class="keyword">if</span> <span class="built_in">hasattr</span>(view, <span class="string">&#x27;permission_code_by_method&#x27;</span>) <span class="keyword">else</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">is_require_permission</span>(<span class="params">self, view</span>) -&gt; bool:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;检查类是否需要权限访问&quot;&quot;&quot;</span></span><br><span class="line">        permission_code, permission_code_by_method = self.get_permission(view)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> permission_code <span class="keyword">or</span> permission_code_by_method:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">query_permission</span>(<span class="params">role_id, code</span>) -&gt; bool:</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;查询权限code，True为满足所有，False为任一不满足。None视为不需要权限，返回True&quot;&quot;&quot;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(code, <span class="built_in">int</span>):</span><br><span class="line">            code = [code]</span><br><span class="line">        <span class="keyword">elif</span> role_id <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">from</span> apps.user.models <span class="keyword">import</span> PermissionCodeRoleRelation</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> code:</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">isinstance</span>(c, <span class="built_in">list</span>):</span><br><span class="line">                <span class="keyword">if</span> <span class="keyword">not</span> CodePermission.query_permission(role_id=role_id, code=c):</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> PermissionCodeRoleRelation.objects.<span class="built_in">filter</span>(role_id=role_id, code=c).count() == <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">has_permission</span>(<span class="params">self, request, view</span>):</span></span><br><span class="line">        <span class="keyword">if</span> self.is_require_permission(view):</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> request.user.role_id:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">            permission_code, permission_code_by_method = self.get_permission(view)</span><br><span class="line">            self.check_permission_format(permission_code, permission_code_by_method, view)</span><br><span class="line">            <span class="keyword">if</span> permission_code_by_method <span class="keyword">and</span> <span class="built_in">isinstance</span>(permission_code_by_method, <span class="built_in">dict</span>):</span><br><span class="line">                permission_action = <span class="built_in">list</span>(</span><br><span class="line">                    <span class="built_in">set</span>(permission_code_by_method.keys()) &amp;</span><br><span class="line">                    <span class="built_in">set</span>([r <span class="keyword">for</span> r <span class="keyword">in</span> self.REQUEST_METHOD_MAP <span class="keyword">if</span> self.REQUEST_METHOD_MAP[r] == request.method])</span><br><span class="line">                )</span><br><span class="line">                permission_action_code = [permission_code_by_method[k] <span class="keyword">for</span> k <span class="keyword">in</span> permission_code_by_method <span class="keyword">if</span></span><br><span class="line">                                          k <span class="keyword">in</span> permission_action <span class="keyword">and</span> permission_code_by_method[k]]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                permission_action_code = []</span><br><span class="line">            <span class="keyword">return</span> self.query_permission(role_id=request.user.role_id, code=permission_code) &amp; self.query_permission(</span><br><span class="line">                role_id=request.user.role_id, code=permission_action_code</span><br><span class="line">            )</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure><p>大体流程为：<code>1.检查PermissionAPIView是否设置了权限，如设置继续判断</code> -&gt; <code>2.获取permission_code等权限信息，检查格式配置是否正确</code> -&gt; <code>3.查询权限配置表，判断用户角色是否存在权限。</code> -&gt; <code>4.返回最终结果</code></p><p>最后修改配置，将此权限设置为drf默认权限即可。</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>使用时非常简单且灵活，继承<code>PermissionAPIView</code>后声明权限码即可。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserProfile</span>(<span class="params">PermissionAPIView</span>):</span></span><br><span class="line">    permission_code = <span class="number">1000</span>          <span class="comment"># 整体要求：角色拥有权限码为 1000</span></span><br><span class="line">    permission_code_by_method = &#123;</span><br><span class="line">        <span class="string">&#x27;get&#x27;</span>: [<span class="number">1001</span>],              <span class="comment"># 整体要求基础上，get方法额外要求1001权限码</span></span><br><span class="line">        <span class="string">&#x27;post&#x27;</span>: [<span class="number">1002</span>, <span class="number">1004</span>],       <span class="comment"># 整体要求基础上，post方法额外要求1002, 1004权限码</span></span><br><span class="line">        <span class="string">&#x27;delete&#x27;</span>: <span class="number">1003</span>              <span class="comment"># 整体要求基础上，删除方法要求1003权限码</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h3 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h3><p>后面将会讨论再此体系下，类似于阿里云RAM子账号的实现方式。</p><p>核心功能是：</p><ol><li>允许父账号生成子账号，并支持基于父账号的权限，全部或部分权限授权给子账号，支持随时吊销或修改。</li><li>权限码的自动注册，管理。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>低配服务器GitLab容器化使用外部Nginx</title>
      <link href="2021/gitLab-use-docker-and-external-nginx/"/>
      <url>2021/gitLab-use-docker-and-external-nginx/</url>
      
        <content type="html"><![CDATA[<h2 id="GitLab使用外部nginx容器化部署并适配小内存服务器"><a href="#GitLab使用外部nginx容器化部署并适配小内存服务器" class="headerlink" title="GitLab使用外部nginx容器化部署并适配小内存服务器"></a>GitLab使用外部nginx容器化部署并适配小内存服务器</h2><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>没办法啊没办法，服务器2C4G，像gitlab这种内存大户，启动之后负载直接飙满。就连执行个<code>docker ps</code>，负载到20你敢信。记录一下部署过程， 主要是在使用外部nginx时走了不少弯路。</p><h3 id="预备安装"><a href="#预备安装" class="headerlink" title="预备安装"></a>预备安装</h3><h4 id="路径信息"><a href="#路径信息" class="headerlink" title="路径信息"></a>路径信息</h4><ul><li>配置目录：<code>/export/server/gitlab</code></li><li>日志目录：<code>/export/logs/gitlab</code></li><li>数据目录：<code>/export/data/gitlab</code></li></ul><h4 id="其他事项"><a href="#其他事项" class="headerlink" title="其他事项"></a>其他事项</h4><ol><li>数据目录为避免迁移导致各种问题建议放置在留有较大空间的分区上，高可用方案可以<a href="https://blog.csdn.net/qq_39101603/article/details/110164018">参考</a>基于DRBD实现方式</li><li>ssh端口22与gitlab冲突，建议修改本机ssh端口为其他。</li><li>外部nginx在本机，所以443端口不可能给gitlab，因此自定义服务端口为：<code>8999</code>，利用nginx反向代理gitlab服务，https配置在外部nginx。</li></ol><h3 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h3><p>一行shell即可启动</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">docker run \</span><br><span class="line">    -d \</span><br><span class="line">    --name gitlab \</span><br><span class="line">    -p 8999:8999 \</span><br><span class="line">    -p 22:22 \</span><br><span class="line">    --name gitlab \</span><br><span class="line">    --volume /export/server/gitlab:/etc/gitlab \</span><br><span class="line">    --volume /export/logs/gitlab:/var/log/gitlab \</span><br><span class="line">    --volume /export/data/gitlab:/var/opt/gitlab \</span><br><span class="line">    gitlab/gitlab-ce</span><br></pre></td></tr></table></figure><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><h4 id="Gitlab"><a href="#Gitlab" class="headerlink" title="Gitlab"></a>Gitlab</h4><p>如果你也是2C4G，那么下面配置直接追加到文件结尾即可。<br>默认配置使用资源比较充分，但对于低配服务器来说有些太满了。除了一些必要的配置，<a href="https://blog.csdn.net/ouyang_peng/article/details/84066417">额外减少一些gitlab服务使用资源</a>也是一个不错的选择。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; &#x2F;export&#x2F;server&#x2F;gitlab&#x2F;gitlab.rb</span><br><span class="line"># gitlab domain</span><br><span class="line">external_url &#39;https:&#x2F;&#x2F;git.lucat.fun&#39;</span><br><span class="line"></span><br><span class="line"># disable self nginx</span><br><span class="line">nginx[&#39;enable&#39;] &#x3D; false</span><br><span class="line"></span><br><span class="line"># external nginx config</span><br><span class="line">gitlab_workhorse[&#39;listen_network&#39;] &#x3D; &quot;tcp&quot;</span><br><span class="line">gitlab_workhorse[&#39;listen_addr&#39;] &#x3D; &quot;0.0.0.0:8999&quot;</span><br><span class="line">web_server[&#39;external_users&#39;] &#x3D; [&#39;nginx&#39;]</span><br><span class="line"></span><br><span class="line"># security settings</span><br><span class="line">gitlab_rails[&#39;rack_attack_git_basic_auth&#39;] &#x3D; &#123;</span><br><span class="line">  &#39;enabled&#39; &#x3D;&gt; true,</span><br><span class="line">  &#39;ip_whitelist&#39; &#x3D;&gt; [&quot;127.0.0.1&quot;],</span><br><span class="line">  &#39;maxretry&#39; &#x3D;&gt; 10,</span><br><span class="line">  &#39;findtime&#39; &#x3D;&gt; 60,</span><br><span class="line">  &#39;bantime&#39; &#x3D;&gt; 3600</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># email</span><br><span class="line">gitlab_rails[&#39;smtp_enable&#39;] &#x3D; true</span><br><span class="line">gitlab_rails[&#39;smtp_address&#39;] &#x3D; &quot;smtp.xxxxx.com&quot;</span><br><span class="line">gitlab_rails[&#39;smtp_port&#39;] &#x3D; 465</span><br><span class="line">gitlab_rails[&#39;smtp_user_name&#39;] &#x3D; &quot;gitlab@xxxxx.com&quot;</span><br><span class="line">gitlab_rails[&#39;smtp_password&#39;] &#x3D; &quot;xxxxx&quot;</span><br><span class="line">gitlab_rails[&#39;smtp_domain&#39;] &#x3D; &quot;xxxxx.com&quot;</span><br><span class="line">gitlab_rails[&#39;smtp_authentication&#39;] &#x3D; &quot;login&quot;</span><br><span class="line">gitlab_rails[&#39;smtp_enable_starttls_auto&#39;] &#x3D; true</span><br><span class="line">gitlab_rails[&#39;gitlab_email_from&#39;] &#x3D; &quot;gitlab@xxxxx.com&quot;</span><br><span class="line">gitlab_rails[&#39;gitlab_email_reply_to&#39;] &#x3D; &quot;gitlab@xxxxx.com&quot;</span><br><span class="line">gitlab_rails[&#39;smtp_tls&#39;] &#x3D; true</span><br><span class="line">user[&quot;git_user_email&quot;] &#x3D; &quot;gitlab@xxxxx.com&quot;</span><br><span class="line"></span><br><span class="line"># optimal configuration</span><br><span class="line">unicorn[&#39;worker_timeout&#39;] &#x3D; 60</span><br><span class="line">unicorn[&#39;worker_processes&#39;] &#x3D; 2</span><br><span class="line">unicorn[&#39;worker_memory_limit_min&#39;] &#x3D; &quot;300 * 1 &lt;&lt; 20&quot;</span><br><span class="line">unicorn[&#39;worker_memory_limit_max&#39;] &#x3D; &quot;500 * 1 &lt;&lt; 20&quot;</span><br><span class="line">sidekiq[&#39;concurrency&#39;] &#x3D; 9</span><br><span class="line">postgresql[&#39;shared_buffers&#39;] &#x3D; &quot;256MB&quot;</span><br><span class="line">postgresql[&#39;max_worker_processes&#39;] &#x3D; 8</span><br></pre></td></tr></table></figure><h4 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h4><p>nginx配置注意一下上传文件大小，其他普通反向代理配置即可。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[root@liyao gitlab]# cat /etc/nginx/conf.d/gitlab.https.conf</span><br><span class="line">server &#123;</span><br><span class="line">   listen 443 ssl;</span><br><span class="line">   server_name xxxx;</span><br><span class="line"></span><br><span class="line">   ssl_certificate ssl/xxxx.pem;</span><br><span class="line">   ssl_certificate_key ssl/xxxx.key;</span><br><span class="line">   ssl_session_timeout 5m;</span><br><span class="line">   ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;</span><br><span class="line">   ssl_protocols TLSv1 TLSv1.1 TLSv1.2;</span><br><span class="line">   ssl_prefer_server_ciphers on;</span><br><span class="line">    location / &#123;</span><br><span class="line">            proxy_pass http://127.0.0.1:8999;</span><br><span class="line">            client_max_body_size 1024m;</span><br><span class="line">            proxy_redirect  off;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">            proxy_set_header X-Real-IP $remote_addr;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>修改完配置后，执行<code>docker exec gitlab gitlab-ctl reconfigure</code>使配置生效。启动完毕后在宿主机使用<code>curl 127.0.0.1:8999</code>测试，没问题上nginx即可。</p><h3 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker exec gitlab gitlab-ctl reconfigure   # 重新应用配置</span><br><span class="line">docker exec gitlab gitlab-ctl status        # 查看gitlab服务状态</span><br><span class="line">docker logs -f gitlab                       # 查看gitlab服务日志</span><br><span class="line">docker rm -f gitlab                         # 删除容器</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> gitlab </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ILO自签证书生成</title>
      <link href="2021/ILO-https/"/>
      <url>2021/ILO-https/</url>
      
        <content type="html"><![CDATA[<p>按照网上教程折腾一翻，发现签发的证书无法在IOS设备上信任，本篇总结了折腾的经过。</p><h3 id="ILO配置"><a href="#ILO配置" class="headerlink" title="ILO配置"></a>ILO配置</h3><h4 id="1-创建工作目录"><a href="#1-创建工作目录" class="headerlink" title="1.创建工作目录"></a>1.创建工作目录</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 创建本次工作目录，防止与其他文件冲突</span></span><br><span class="line"><span class="built_in">cd</span> ~ &amp;&amp; mkdir ssl &amp;&amp; <span class="built_in">cd</span> ssl</span><br></pre></td></tr></table></figure><h4 id="2-生成根证书配置文件"><a href="#2-生成根证书配置文件" class="headerlink" title="2.生成根证书配置文件"></a>2.生成根证书配置文件</h4><p>可以修改 <code>[req_distinguished_name]</code>下的信息，DNS中修改为你的域名，ip每行仅限一个，不支持通配符</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; config.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">[ req ]</span></span><br><span class="line"><span class="string">default_bits        = 2048</span></span><br><span class="line"><span class="string">distinguished_name  = req_distinguished_name</span></span><br><span class="line"><span class="string">req_extensions      = SAN</span></span><br><span class="line"><span class="string">extensions          = SAN</span></span><br><span class="line"><span class="string">[ req_distinguished_name ]</span></span><br><span class="line"><span class="string">countryName             = CN</span></span><br><span class="line"><span class="string">stateOrProvinceName = Beijing</span></span><br><span class="line"><span class="string">localityName = Beijing</span></span><br><span class="line"><span class="string">0.organizationName  = LiYao&#x27;s House.</span></span><br><span class="line"><span class="string">organizationalUnitName      = LiYao Private service</span></span><br><span class="line"><span class="string">[ alternate_names ]</span></span><br><span class="line"><span class="string">DNS.1 = liyao.house</span></span><br><span class="line"><span class="string">DNS.2 = *.liyao.house</span></span><br><span class="line"><span class="string">IP.1 = 192.168.1.1</span></span><br><span class="line"><span class="string">[SAN]</span></span><br><span class="line"><span class="string">subjectAltName      = @alternate_names</span></span><br><span class="line"><span class="string">extendedKeyUsage    = serverAuth</span></span><br><span class="line"><span class="string">basicConstraints=CA:TRUE,pathlen:0</span></span><br></pre></td></tr></table></figure><h4 id="3-生成根证书"><a href="#3-生成根证书" class="headerlink" title="3.生成根证书"></a>3.生成根证书</h4><p>subj会是设备上显示的实际名字</p><div align="center">    <img src="https://cdn.lucat.fun/blog/2021-03/IMG_3DAA05282C15-1-pS64sh.jpeg-w" width="80%"/></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># openssl生成根证书，2048已经不安全，改为4096</span></span><br><span class="line">openssl req \</span><br><span class="line">    -newkey rsa:4096 \</span><br><span class="line">    -x509 \</span><br><span class="line">    -nodes \</span><br><span class="line">    -keyout rootCA.key \</span><br><span class="line">    -new \</span><br><span class="line">    -out rootCA.pem \</span><br><span class="line">    -subj <span class="string">&quot;/emailAddress=liyao@lucat.fun/CN=LiYao&#x27;s House/C=CN/ST=Beijing/L=Beijing/O=LiYao Inc./OU=LiYao Private Service.&quot;</span> \</span><br><span class="line">    -config ./config.cnf \</span><br><span class="line">    -reqexts SAN \</span><br><span class="line">    -extensions SAN \</span><br><span class="line">    -sha256 \</span><br><span class="line">    -days 36500</span><br></pre></td></tr></table></figure><h4 id="4-获取csr文件"><a href="#4-获取csr文件" class="headerlink" title="4.获取csr文件"></a>4.获取csr文件</h4><ul><li>情况一，csr由服务方提供，如：ilo服务需要在他的平台生成csr，登录平台操作<div align="center">  <img src="https://cdn.lucat.fun/blog/2021-03/1616571540108-PSd22u.jpg-w" width="80%"/></div></li></ul><p>如图所示，生成需要稍微等待一会，按照提示获取后，保存到<code>ssl/ilo.csr</code> 中，注意旁边有一个导入证书，一会会回来操作。</p><ul><li>情况二，是给nginx或第三方服务生成，这种直接进行自签操作</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out client.key 4096</span><br><span class="line"></span><br><span class="line">openssl req -new -sha256 \</span><br><span class="line">        -key client.key -subj &quot;/emailAddress=liyao@lucat.fun/CN=LiYao&#x27;s House./C=CN/ST=Beijing/L=Beijing/O=LiYao Inc./OU=LiYao Private Service.&quot; \</span><br><span class="line">        -config ./config.cnf \</span><br><span class="line">        -reqexts SAN \</span><br><span class="line">        -extensions SAN \</span><br><span class="line">        -sha256 \</span><br><span class="line">        -out client.csr</span><br></pre></td></tr></table></figure><h4 id="5-生成crt文件"><a href="#5-生成crt文件" class="headerlink" title="5.生成crt文件"></a>5.生成crt文件</h4><p>首先生成证书配置文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; client.cnf &lt;&lt;<span class="string">EOF</span></span><br><span class="line"><span class="string">authorityKeyIdentifier=keyid,issuer</span></span><br><span class="line"><span class="string">basicConstraints=CA:FALSE</span></span><br><span class="line"><span class="string">keyUsage=digitalSignature, nonRepudiation, keyEncipherment, dataEncipherment</span></span><br><span class="line"><span class="string">subjectAltName=@alt_names</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ req ]</span></span><br><span class="line"><span class="string">default_bits = 2048</span></span><br><span class="line"><span class="string">distinguished_name = req_distinguished_name</span></span><br><span class="line"><span class="string">req_extensions = SAN</span></span><br><span class="line"><span class="string">extensions = SAN</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ req_distinguished_name ]</span></span><br><span class="line"><span class="string">countryName = CN</span></span><br><span class="line"><span class="string">stateOrProvinceName = Beijing</span></span><br><span class="line"><span class="string">localityName = Beijing</span></span><br><span class="line"><span class="string">organizationName = LiYao&#x27;s House</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[SAN]</span></span><br><span class="line"><span class="string">subjectAltName = @alt_names</span></span><br><span class="line"><span class="string">extendedKeyUsage = serverAuth</span></span><br><span class="line"><span class="string">basicConstraints=CA:TRUE,pathlen:0</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[alt_names]</span></span><br><span class="line"><span class="string">DNS.1 = *.liyao.house</span></span><br><span class="line"><span class="string">DNS.2 = liyao.house</span></span><br><span class="line"><span class="string">IP.1 = 192.168.1.1</span></span><br><span class="line"><span class="string">EOF</span></span><br></pre></td></tr></table></figure><p>这里，证书签发的时间不能超过825天，否则chrome或safari会提示证书不信任：<code>NET::ERR_CERT_VALIDITY_TOO_LONG</code>，意思证书时间过长。</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">openssl x509 -req \</span><br><span class="line">        -<span class="keyword">in</span> client.csr -CA rootCA.pem -CAkey rootCA.key \</span><br><span class="line">        -out client.crt \</span><br><span class="line">        -CAcreateserial  \</span><br><span class="line">        -days 824 \</span><br><span class="line">        -sha256 \</span><br><span class="line">        -extensions SAN \</span><br><span class="line">        -extfile client.cnf </span><br><span class="line"></span><br></pre></td></tr></table></figure><p>将<code>ilo.crt</code>中的内容，粘贴至刚才ilo管理界面导入证书的入口。等待重启。</p><h3 id="MacOS配置"><a href="#MacOS配置" class="headerlink" title="MacOS配置"></a>MacOS配置</h3><p>执行<code>open .</code> 打开ssl目录，双击<code>rootCA.pem</code>安装根证书，双击修改证书信任策略为<code>始终信任</code></p><div align="center">    <img src="https://cdn.lucat.fun/blog/2021-03/ilo2-FmlOWy.png-w" width="80%"/></div><p>退出浏览器重新打开，锁则变为绿色</p><h3 id="Iphone设置"><a href="#Iphone设置" class="headerlink" title="Iphone设置"></a>Iphone设置</h3><p>使用隔空投送，将<code>rootCA.pem</code>推送至手机，用QQ，微信好像不行，不支持打开。</p><ol><li>打开系统设置，点击添加提示，信任描述文件。</li><li>通用，关于本机下滑到底，证书信任设置中开启对证书的信任。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> NAS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Go学习笔记-基础篇</title>
      <link href="2021/Golang-study-day1/"/>
      <url>2021/Golang-study-day1/</url>
      
        <content type="html"><![CDATA[<h2 id="数值"><a href="#数值" class="headerlink" title="数值"></a>数值</h2><h3 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h3><p><code>fmt</code>是go的一个基础包，是单词<code>Format</code>的缩写，负责数值打印和数值格式化等功能</p><ul><li>fmt.Print（普通的print）</li><li>fmt.Printf（从C语言的printf衍生而来，增加格式化打印）</li><li>fmt.Println（普通的print增加了换行）</li></ul><p>Printf格式化整理：</p><table><thead><tr><th>格式</th><th>值</th></tr></thead><tbody><tr><td>%d</td><td>int(数字)</td></tr><tr><td>%s</td><td>string(字符串)</td></tr><tr><td>%f</td><td>float(浮点数)</td></tr><tr><td>%v</td><td>(根据原数据格式自动转换，万能)</td></tr></tbody></table><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight golang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> main</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line"><span class="keyword">var</span> name <span class="keyword">string</span> = <span class="string">&quot;liyao&quot;</span></span><br><span class="line"><span class="keyword">var</span> name2 = <span class="string">&quot;liyao&quot;</span></span><br><span class="line">name3 := <span class="string">&quot;liyao&quot;</span></span><br><span class="line"></span><br><span class="line">value := <span class="number">1</span></span><br><span class="line">value2 := <span class="number">1.0</span></span><br><span class="line">value3 := <span class="string">&quot;default&quot;</span></span><br><span class="line">value4 := <span class="number">4</span></span><br><span class="line"></span><br><span class="line">fmt.Printf(<span class="string">&quot;name: %s, name2: %s, name3: %s\n&quot;</span>, name, name2, name3)</span><br><span class="line">fmt.Printf(<span class="string">&quot;int value: %d, float value:%f, default value: %v, defalut value4: %v&quot;</span>, value, value2, value3, value4)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> golang </tag>
            
            <tag> 学习 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python爬取抖音数据</title>
      <link href="2021/python-spider-tiktok/"/>
      <url>2021/python-spider-tiktok/</url>
      
        <content type="html"><![CDATA[<div class="note orange icon flat"><i class="note-icon fas fa-bullhorn"></i><p>仅供学习参考，请勿用于非法目的，如有侵权请联系我删除。</p></div><h1 id="获取抖音作品详情"><a href="#获取抖音作品详情" class="headerlink" title="获取抖音作品详情"></a>获取抖音作品详情</h1><h2 id="接口分析"><a href="#接口分析" class="headerlink" title="接口分析"></a>接口分析</h2><p>获取视频信息，切入点是抖音的分享链接</p><p>随便找一个视频，获取分享链接</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">尝试臭豆腐肥肠火锅？这味道简直太太太上头了！！%vlog日常 %美食探店 %火锅 %深夜放毒 %美食趣胃计划  https:&#x2F;&#x2F;v.douyin.com&#x2F;eNBofpr&#x2F; 椱制此链接，打开Dou吟搜索，直接觀看视频！</span><br></pre></td></tr></table></figure><p>获取到链接：<code>https://v.douyin.com/eNBofpr/</code> ，后续便以此为测试数据。</p><p>打开Chrome调试模式，很轻松的能定位到实际访问的数据接口：<code>https://www.iesdouyin.com/web/api/v2/aweme/iteminfo/?item_ids=6942073391922842894</code></p><div align="center">    <img src="https://cdn.lucat.fun/blog/2021-03/douyin1-7bbwFh.png-w" width="80%"/></div><p>其中item_ids对应的就是本视频的ID:<code>6942073391922842894</code>，眼尖一点就能发现，这个ID出现在了重定向后的Url中。</p><p>下面就简单了，整理一下步骤：</p><ol><li>获取分享链接</li><li>访问分享链接</li><li>通过重定向后的分享链接获取作品实际ID</li><li>调用API接口，获取作品信息</li></ol><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭烦人提示</span></span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_share_content</span>(<span class="params">share_content: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    从App端分享信息中提取分享作品短链接</span></span><br><span class="line"><span class="string">    :param share_content:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    url_regular = re.<span class="built_in">compile</span>(<span class="string">r&quot;(https|http)?:\/\/(([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;|([0-9a-zA-Z_!~*&#x27;()-]+\.)*([0-9a-zA-Z]&quot;</span></span><br><span class="line">                             <span class="string">r&quot;[0-9a-zA-Z-]&#123;0,61&#125;)?[0-9a-zA-Z]\.[0-9a-zA-Z]&#123;2,6&#125;)(:[0-9a-zA-Z]&#123;1,4&#125;)?&quot;</span></span><br><span class="line">                             <span class="string">r&quot;((\/[0-9a-zA-Z_!~*().;?:@&amp;=+$,%#-]*)+)?&quot;</span>)</span><br><span class="line">    result = url_regular.search(share_content)</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="comment"># 重复判断一次，防止提取错误</span></span><br><span class="line">        <span class="keyword">if</span> result.group(<span class="number">0</span>) <span class="keyword">in</span> share_content:</span><br><span class="line">            <span class="keyword">return</span> result.group(<span class="number">0</span>).strip()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;请输入标准的抖音分享信息&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;请输入标准的抖音分享信息&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resolve_share_url</span>(<span class="params">share_url: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    解析分享链接，提取作品ID</span></span><br><span class="line"><span class="string">    :param share_url:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    resp = requests.get(share_url, verify=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># url解码</span></span><br><span class="line">    url_data = parse.unquote(resp.url)</span><br><span class="line">    <span class="comment"># url结果</span></span><br><span class="line">    result = parse.urlparse(url_data)</span><br><span class="line">    <span class="comment"># url里的查询参数</span></span><br><span class="line">    video_id = <span class="built_in">str</span>(result.path).split(<span class="string">&#x27;/&#x27;</span>)[-<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">if</span> video_id.isdigit():</span><br><span class="line">        <span class="keyword">return</span> video_id</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;获取作品ID异常，请检查连接：%s是否为抖音分享链接。&#x27;</span> % share_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_tiktok_item_info</span>(<span class="params">share_content: <span class="built_in">str</span></span>) -&gt; dict:</span></span><br><span class="line">    share_url = handle_share_content(share_content)</span><br><span class="line">    item_id = resolve_share_url(share_url)</span><br><span class="line"></span><br><span class="line">    response = requests.get(<span class="string">&quot;https://www.iesdouyin.com/web/api/v2/aweme/iteminfo/&quot;</span>,</span><br><span class="line">                                params=&#123;<span class="string">&#x27;item_ids&#x27;</span>: item_id&#125;, verify=<span class="literal">False</span>, timeout=<span class="number">5</span>).json()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> response[<span class="string">&#x27;status_code&#x27;</span>] == <span class="number">0</span> <span class="keyword">and</span> <span class="built_in">len</span>(response[<span class="string">&#x27;item_list&#x27;</span>]) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> response[<span class="string">&#x27;item_list&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 数据不存在</span></span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;获取抖音Api数据失败，%s&#x27;</span> % response)</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;尝试臭豆腐肥肠火锅？这味道简直太太太上头了！！%vlog日常 %美食探店 %火锅 %深夜放毒 %美食趣胃计划&#x27;</span> \</span><br><span class="line">       <span class="string">&#x27;https://v.douyin.com/eNBofpr/ 椱制此链接，打开Dou吟搜索，直接觀看视频！&#x27;</span></span><br><span class="line"></span><br><span class="line">info = get_tiktok_item_info(share_content=data)</span><br><span class="line">print(info)</span><br><span class="line"></span><br><span class="line"><span class="comment">### OutPut</span></span><br><span class="line">&#123;<span class="string">&#x27;is_live_replay&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;video_labels&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;geofencing&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;group_id&#x27;</span>: <span class="number">6942073391922843000</span>, <span class="string">&#x27;forward_id&#x27;</span>: <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;author&#x27;</span>: &#123;<span class="string">&#x27;policy_version&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="string">&#x27;76615500441&#x27;</span>, <span class="string">&#x27;short_id&#x27;</span>: <span class="string">&#x27;2262937117&#x27;</span>, <span class="string">&#x27;avatar_thumb&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;100x100/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p5-ipv6.douyinpic.com/aweme/100x100/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p6.douyinpic.com/aweme/100x100/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/aweme/100x100/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;avatar_medium&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;720x720/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p3.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p29.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;unique_id&#x27;</span>: <span class="string">&#x27;xiaozhuzhu2334&#x27;</span>, <span class="string">&#x27;platform_sync_info&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;nickname&#x27;</span>: <span class="string">&#x27;帅气的悉尼小猪猪&#x27;</span>, <span class="string">&#x27;signature&#x27;</span>: <span class="string">&#x27;🧣同名\n合作：taozi484520（只接星图）&#x27;</span>, <span class="string">&#x27;avatar_larger&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;1080x1080/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p3.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p5-ipv6.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;followers_detail&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;geofencing&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;type_label&#x27;</span>: <span class="literal">None</span>&#125;, <span class="string">&#x27;video&#x27;</span>: &#123;<span class="string">&#x27;origin_cover&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-p-0015/8111a1cf615e48d8a06d8363c91e8250_1616327449&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p29.douyinpic.com/tos-cn-p-0015/8111a1cf615e48d8a06d8363c91e8250_1616327449~tplv-dy-360p.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p6.douyinpic.com/tos-cn-p-0015/8111a1cf615e48d8a06d8363c91e8250_1616327449~tplv-dy-360p.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p5-ipv6.douyinpic.com/tos-cn-p-0015/8111a1cf615e48d8a06d8363c91e8250_1616327449~tplv-dy-360p.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;ratio&#x27;</span>: <span class="string">&#x27;720p&#x27;</span>, <span class="string">&#x27;duration&#x27;</span>: <span class="number">90139</span>, <span class="string">&#x27;is_long_video&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;play_addr&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;v0200fcf0000c1bj4fmluf3igni150tg&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200fcf0000c1bj4fmluf3igni150tg&amp;ratio=720p&amp;line=0&#x27;</span>]&#125;, <span class="string">&#x27;cover&#x27;</span>: &#123;<span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p29.douyinpic.com/img/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27~c5_300x400.jpeg?from=2563711402_large&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/img/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27~c5_300x400.jpeg?from=2563711402_large&#x27;</span>, <span class="string">&#x27;https://p5-ipv6.douyinpic.com/img/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27~c5_300x400.jpeg?from=2563711402_large&#x27;</span>], <span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27&#x27;</span>&#125;, <span class="string">&#x27;dynamic_cover&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p5-ipv6.douyinpic.com/obj/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27?from=2563711402_large&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/obj/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27?from=2563711402_large&#x27;</span>, <span class="string">&#x27;https://p3.douyinpic.com/obj/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27?from=2563711402_large&#x27;</span>]&#125;, <span class="string">&#x27;bit_rate&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;vid&#x27;</span>: <span class="string">&#x27;v0200fcf0000c1bj4fmluf3igni150tg&#x27;</span>, <span class="string">&#x27;height&#x27;</span>: <span class="number">1920</span>, <span class="string">&#x27;width&#x27;</span>: <span class="number">1080</span>, <span class="string">&#x27;has_watermark&#x27;</span>: <span class="literal">True</span>&#125;, <span class="string">&#x27;share_info&#x27;</span>: &#123;<span class="string">&#x27;share_weibo_desc&#x27;</span>: <span class="string">&#x27;#在抖音，记录美好生活#尝试臭豆腐肥肠火锅？这味道简直太太太上头了！！#vlog日常 #美食探店 #火锅 #深夜放毒 #美食趣胃计划&#x27;</span>, <span class="string">&#x27;share_desc&#x27;</span>: <span class="string">&#x27;在抖音，记录美好生活&#x27;</span>, <span class="string">&#x27;share_title&#x27;</span>: <span class="string">&#x27;尝试臭豆腐肥肠火锅？这味道简直太太太上头了！！#vlog日常 #美食探店 #火锅 #深夜放毒 #美食趣胃计划&#x27;</span>&#125;, <span class="string">&#x27;video_text&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1616328562</span>, <span class="string">&#x27;cha_list&#x27;</span>: [&#123;<span class="string">&#x27;user_count&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;is_commerce&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;cid&#x27;</span>: <span class="string">&#x27;1558567968378882&#x27;</span>, <span class="string">&#x27;cha_name&#x27;</span>: <span class="string">&#x27;深夜放毒&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;hash_tag_profile&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;connect_music&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;view_count&#x27;</span>: <span class="number">0</span>&#125;], <span class="string">&#x27;image_infos&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;author_user_id&#x27;</span>: <span class="number">76615500441</span>, <span class="string">&#x27;desc&#x27;</span>: <span class="string">&#x27;尝试臭豆腐肥肠火锅？这味道简直太太太上头了！！#vlog日常 #美食探店 #火锅 #深夜放毒 #美食趣胃计划&#x27;</span>, <span class="string">&#x27;images&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;promotions&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;share_url&#x27;</span>: <span class="string">&#x27;https://www.iesdouyin.com/share/video/6942073391922842894/?region=&amp;mid=6942073520700607269&amp;u_code=48&amp;titleType=title&amp;did=MS4wLjABAAAANwkJuWIRFOzg5uCpDRpMj4OX-QryoDgn-yYlXQnRwQQ&amp;iid=MS4wLjABAAAANwkJuWIRFOzg5uCpDRpMj4OX-QryoDgn-yYlXQnRwQQ&amp;with_sec_did=1&#x27;</span>, <span class="string">&#x27;label_top_text&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;mix_info&#x27;</span>: &#123;<span class="string">&#x27;mix_id&#x27;</span>: <span class="string">&#x27;6812903915307141134&#x27;</span>, <span class="string">&#x27;mix_name&#x27;</span>: <span class="string">&#x27;猪猪的美食vlog！&#x27;</span>, <span class="string">&#x27;statis&#x27;</span>: &#123;<span class="string">&#x27;updated_to_episode&#x27;</span>: <span class="number">55</span>, <span class="string">&#x27;play_vv&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;collect_vv&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;current_episode&#x27;</span>: <span class="number">55</span>&#125;, <span class="string">&#x27;extra&#x27;</span>: <span class="string">&#x27;&#123;&quot;douyin_search_ocr_content&quot;:&quot;猪猪带你吃吃吃，吃饱了才能减肥嘛！&quot;,&quot;douyin_search_user_generated_title&quot;:&quot;  美食 计划 &quot;,&quot;first_reviewed&quot;:1,&quot;is_quality_mix&quot;:0,&quot;next_info&quot;:&#123;&quot;cover&quot;:&quot;tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&quot;,&quot;desc&quot;:&quot;猪猪带你吃吃吃，吃饱了才能减肥嘛！&quot;,&quot;name&quot;:&quot;猪猪的美食vlog！&quot;&#125;,&quot;origin_challenge_content&quot;:&quot;&quot;&#125;&#x27;</span>, <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1586252804</span>, <span class="string">&#x27;cover_url&#x27;</span>: &#123;<span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p5-ipv6.douyinpic.com/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d?from=2563711402&#x27;</span>], <span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>&#125;, <span class="string">&#x27;status&#x27;</span>: &#123;<span class="string">&#x27;status&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;is_collected&#x27;</span>: <span class="number">0</span>&#125;, <span class="string">&#x27;desc&#x27;</span>: <span class="string">&#x27;猪猪带你吃吃吃，吃饱了才能减肥嘛！&#x27;</span>, <span class="string">&#x27;next_info&#x27;</span>: &#123;<span class="string">&#x27;mix_name&#x27;</span>: <span class="string">&#x27;猪猪的美食vlog！&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>: <span class="string">&#x27;猪猪带你吃吃吃，吃饱了才能减肥嘛！&#x27;</span>, <span class="string">&#x27;cover_url&#x27;</span>: &#123;<span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p1-dy.bytecdn.cn/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>, <span class="string">&#x27;https://p3-dy.bytecdn.cn/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>, <span class="string">&#x27;https://p9-dy.bytecdn.cn/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>], <span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>&#125;&#125;&#125;, <span class="string">&#x27;category&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;is_preview&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;aweme_id&#x27;</span>: <span class="string">&#x27;6942073391922842894&#x27;</span>, <span class="string">&#x27;text_extra&#x27;</span>: [&#123;<span class="string">&#x27;start&#x27;</span>: <span class="number">23</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">30</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;vlog日常&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1607783788304387</span>&#125;, &#123;<span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;美食探店&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1591486437085198</span>, <span class="string">&#x27;start&#x27;</span>: <span class="number">31</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">36</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>&#125;, &#123;<span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;火锅&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1553400994340865</span>, <span class="string">&#x27;start&#x27;</span>: <span class="number">37</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">40</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>&#125;, &#123;<span class="string">&#x27;start&#x27;</span>: <span class="number">41</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">46</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;深夜放毒&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1558567968378882</span>&#125;, &#123;<span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;美食趣胃计划&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1657693004378126</span>, <span class="string">&#x27;start&#x27;</span>: <span class="number">47</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">54</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>&#125;], <span class="string">&#x27;aweme_type&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;long_video&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;music&#x27;</span>: &#123;<span class="string">&#x27;cover_medium&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;720x720/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p9.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;cover_thumb&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;168x168/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p5-ipv6.douyinpic.com/img/20b7b00015cd04a8ec0cb~c5_168x168.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/img/20b7b00015cd04a8ec0cb~c5_168x168.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p9.douyinpic.com/img/20b7b00015cd04a8ec0cb~c5_168x168.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;play_url&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;https://sf6-cdn-tos.douyinstatic.com/obj/ies-music/6942073506247379719.mp3&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://sf6-cdn-tos.douyinstatic.com/obj/ies-music/6942073506247379719.mp3&#x27;</span>, <span class="string">&#x27;https://sf3-cdn-tos.douyinstatic.com/obj/ies-music/6942073506247379719.mp3&#x27;</span>]&#125;, <span class="string">&#x27;duration&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;position&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;mid&#x27;</span>: <span class="string">&#x27;6942073520700607269&#x27;</span>, <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;@帅气的悉尼小猪猪创作的原声&#x27;</span>, <span class="string">&#x27;cover_hd&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;1080x1080/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p26.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p29.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;cover_large&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;1080x1080/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p26.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p29.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;status&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;id&#x27;</span>: <span class="number">6942073520700607000</span>, <span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;帅气的悉尼小猪猪&#x27;</span>&#125;, <span class="string">&#x27;duration&#x27;</span>: <span class="number">90139</span>, <span class="string">&#x27;risk_infos&#x27;</span>: &#123;<span class="string">&#x27;warn&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;, <span class="string">&#x27;comment_list&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;anchor_info&#x27;</span>: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;6867104903072860167&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">2</span>&#125;, <span class="string">&#x27;statistics&#x27;</span>: &#123;<span class="string">&#x27;aweme_id&#x27;</span>: <span class="string">&#x27;6942073391922842894&#x27;</span>, <span class="string">&#x27;comment_count&#x27;</span>: <span class="number">15234</span>, <span class="string">&#x27;digg_count&#x27;</span>: <span class="number">149138</span>, <span class="string">&#x27;play_count&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;share_count&#x27;</span>: <span class="number">4860</span>&#125;&#125;</span><br></pre></td></tr></table></figure><h1 id="抖音无水印视频"><a href="#抖音无水印视频" class="headerlink" title="抖音无水印视频"></a>抖音无水印视频</h1><h2 id="接口分析-1"><a href="#接口分析-1" class="headerlink" title="接口分析"></a>接口分析</h2><p>上一小结获取的抖音视频信息中，可以在返回结果的<code>video -&gt; play_addr -&gt; url_list</code>找到视频的地址，但是是有水印的。有没有办法获取无水印的视频呢？</p><p>观察视频地址：<code>https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200fcf0000c1bj4fmluf3igni150tg&amp;ratio=720p&amp;line=0</code></p><p>尝试去掉参数之后发现仍可以正常访问，所以和传入的参数<code>ratio</code> 和<code>line</code>关系不大。正当一筹莫展之际，突然发现<code>https://aweme.snssdk.com/aweme/v1/playwm/</code> 中的最后一段地址有点奇怪，<code>playvm</code>不像是一个单词。猜想wm是英文水印(water mark)的缩写。</p><p>果然，去掉之后是无水印的版本</p><div class="justified-gallery"><p><img src="https://cdn.lucat.fun/blog/2021-03/douyin2-sTAvvQ.png-w" alt="有水印"><br><img src="https://cdn.lucat.fun/blog/2021-03/douyin3-bu1w8w.png-w" alt="无水印"></p>          </div><h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># info 为上一节返回的作品信息，这里直接定义，不在重复</span></span><br><span class="line">info = &#123;<span class="string">&#x27;is_live_replay&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;video_labels&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;geofencing&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;group_id&#x27;</span>: <span class="number">6942073391922843000</span>, <span class="string">&#x27;forward_id&#x27;</span>: <span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;author&#x27;</span>: &#123;<span class="string">&#x27;policy_version&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="string">&#x27;76615500441&#x27;</span>, <span class="string">&#x27;short_id&#x27;</span>: <span class="string">&#x27;2262937117&#x27;</span>, <span class="string">&#x27;avatar_thumb&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;100x100/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p5-ipv6.douyinpic.com/aweme/100x100/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p6.douyinpic.com/aweme/100x100/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/aweme/100x100/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;avatar_medium&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;720x720/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p3.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p29.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;unique_id&#x27;</span>: <span class="string">&#x27;xiaozhuzhu2334&#x27;</span>, <span class="string">&#x27;platform_sync_info&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;nickname&#x27;</span>: <span class="string">&#x27;帅气的悉尼小猪猪&#x27;</span>, <span class="string">&#x27;signature&#x27;</span>: <span class="string">&#x27;🧣同名\n合作：taozi484520（只接星图）&#x27;</span>, <span class="string">&#x27;avatar_larger&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;1080x1080/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p3.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p5-ipv6.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;followers_detail&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;geofencing&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;type_label&#x27;</span>: <span class="literal">None</span>&#125;, <span class="string">&#x27;video&#x27;</span>: &#123;<span class="string">&#x27;origin_cover&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-p-0015/8111a1cf615e48d8a06d8363c91e8250_1616327449&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p29.douyinpic.com/tos-cn-p-0015/8111a1cf615e48d8a06d8363c91e8250_1616327449~tplv-dy-360p.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p6.douyinpic.com/tos-cn-p-0015/8111a1cf615e48d8a06d8363c91e8250_1616327449~tplv-dy-360p.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p5-ipv6.douyinpic.com/tos-cn-p-0015/8111a1cf615e48d8a06d8363c91e8250_1616327449~tplv-dy-360p.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;ratio&#x27;</span>: <span class="string">&#x27;720p&#x27;</span>, <span class="string">&#x27;duration&#x27;</span>: <span class="number">90139</span>, <span class="string">&#x27;is_long_video&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;play_addr&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;v0200fcf0000c1bj4fmluf3igni150tg&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://aweme.snssdk.com/aweme/v1/playwm/?video_id=v0200fcf0000c1bj4fmluf3igni150tg&amp;ratio=720p&amp;line=0&#x27;</span>]&#125;, <span class="string">&#x27;cover&#x27;</span>: &#123;<span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p29.douyinpic.com/img/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27~c5_300x400.jpeg?from=2563711402_large&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/img/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27~c5_300x400.jpeg?from=2563711402_large&#x27;</span>, <span class="string">&#x27;https://p5-ipv6.douyinpic.com/img/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27~c5_300x400.jpeg?from=2563711402_large&#x27;</span>], <span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27&#x27;</span>&#125;, <span class="string">&#x27;dynamic_cover&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p5-ipv6.douyinpic.com/obj/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27?from=2563711402_large&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/obj/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27?from=2563711402_large&#x27;</span>, <span class="string">&#x27;https://p3.douyinpic.com/obj/tos-cn-p-0015/fdabcc862cbc4698a4ee4feb42a9ee27?from=2563711402_large&#x27;</span>]&#125;, <span class="string">&#x27;bit_rate&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;vid&#x27;</span>: <span class="string">&#x27;v0200fcf0000c1bj4fmluf3igni150tg&#x27;</span>, <span class="string">&#x27;height&#x27;</span>: <span class="number">1920</span>, <span class="string">&#x27;width&#x27;</span>: <span class="number">1080</span>, <span class="string">&#x27;has_watermark&#x27;</span>: <span class="literal">True</span>&#125;, <span class="string">&#x27;share_info&#x27;</span>: &#123;<span class="string">&#x27;share_weibo_desc&#x27;</span>: <span class="string">&#x27;#在抖音，记录美好生活#尝试臭豆腐肥肠火锅？这味道简直太太太上头了！！#vlog日常 #美食探店 #火锅 #深夜放毒 #美食趣胃计划&#x27;</span>, <span class="string">&#x27;share_desc&#x27;</span>: <span class="string">&#x27;在抖音，记录美好生活&#x27;</span>, <span class="string">&#x27;share_title&#x27;</span>: <span class="string">&#x27;尝试臭豆腐肥肠火锅？这味道简直太太太上头了！！#vlog日常 #美食探店 #火锅 #深夜放毒 #美食趣胃计划&#x27;</span>&#125;, <span class="string">&#x27;video_text&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1616328562</span>, <span class="string">&#x27;cha_list&#x27;</span>: [&#123;<span class="string">&#x27;user_count&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;is_commerce&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;cid&#x27;</span>: <span class="string">&#x27;1558567968378882&#x27;</span>, <span class="string">&#x27;cha_name&#x27;</span>: <span class="string">&#x27;深夜放毒&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;hash_tag_profile&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;connect_music&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;view_count&#x27;</span>: <span class="number">0</span>&#125;], <span class="string">&#x27;image_infos&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;author_user_id&#x27;</span>: <span class="number">76615500441</span>, <span class="string">&#x27;desc&#x27;</span>: <span class="string">&#x27;尝试臭豆腐肥肠火锅？这味道简直太太太上头了！！#vlog日常 #美食探店 #火锅 #深夜放毒 #美食趣胃计划&#x27;</span>, <span class="string">&#x27;images&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;promotions&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;share_url&#x27;</span>: <span class="string">&#x27;https://www.iesdouyin.com/share/video/6942073391922842894/?region=&amp;mid=6942073520700607269&amp;u_code=48&amp;titleType=title&amp;did=MS4wLjABAAAANwkJuWIRFOzg5uCpDRpMj4OX-QryoDgn-yYlXQnRwQQ&amp;iid=MS4wLjABAAAANwkJuWIRFOzg5uCpDRpMj4OX-QryoDgn-yYlXQnRwQQ&amp;with_sec_did=1&#x27;</span>, <span class="string">&#x27;label_top_text&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;mix_info&#x27;</span>: &#123;<span class="string">&#x27;mix_id&#x27;</span>: <span class="string">&#x27;6812903915307141134&#x27;</span>, <span class="string">&#x27;mix_name&#x27;</span>: <span class="string">&#x27;猪猪的美食vlog！&#x27;</span>, <span class="string">&#x27;statis&#x27;</span>: &#123;<span class="string">&#x27;updated_to_episode&#x27;</span>: <span class="number">55</span>, <span class="string">&#x27;play_vv&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;collect_vv&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;current_episode&#x27;</span>: <span class="number">55</span>&#125;, <span class="string">&#x27;extra&#x27;</span>: <span class="string">&#x27;&#123;&quot;douyin_search_ocr_content&quot;:&quot;猪猪带你吃吃吃，吃饱了才能减肥嘛！&quot;,&quot;douyin_search_user_generated_title&quot;:&quot;  美食 计划 &quot;,&quot;first_reviewed&quot;:1,&quot;is_quality_mix&quot;:0,&quot;next_info&quot;:&#123;&quot;cover&quot;:&quot;tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&quot;,&quot;desc&quot;:&quot;猪猪带你吃吃吃，吃饱了才能减肥嘛！&quot;,&quot;name&quot;:&quot;猪猪的美食vlog！&quot;&#125;,&quot;origin_challenge_content&quot;:&quot;&quot;&#125;&#x27;</span>, <span class="string">&#x27;create_time&#x27;</span>: <span class="number">1586252804</span>, <span class="string">&#x27;cover_url&#x27;</span>: &#123;<span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p5-ipv6.douyinpic.com/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d?from=2563711402&#x27;</span>], <span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>&#125;, <span class="string">&#x27;status&#x27;</span>: &#123;<span class="string">&#x27;status&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;is_collected&#x27;</span>: <span class="number">0</span>&#125;, <span class="string">&#x27;desc&#x27;</span>: <span class="string">&#x27;猪猪带你吃吃吃，吃饱了才能减肥嘛！&#x27;</span>, <span class="string">&#x27;next_info&#x27;</span>: &#123;<span class="string">&#x27;mix_name&#x27;</span>: <span class="string">&#x27;猪猪的美食vlog！&#x27;</span>, <span class="string">&#x27;desc&#x27;</span>: <span class="string">&#x27;猪猪带你吃吃吃，吃饱了才能减肥嘛！&#x27;</span>, <span class="string">&#x27;cover_url&#x27;</span>: &#123;<span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p1-dy.bytecdn.cn/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>, <span class="string">&#x27;https://p3-dy.bytecdn.cn/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>, <span class="string">&#x27;https://p9-dy.bytecdn.cn/obj/tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>], <span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;tos-cn-i-0813/2cebe1ba64a9413d8e85383a0651a64d&#x27;</span>&#125;&#125;&#125;, <span class="string">&#x27;category&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;is_preview&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;aweme_id&#x27;</span>: <span class="string">&#x27;6942073391922842894&#x27;</span>, <span class="string">&#x27;text_extra&#x27;</span>: [&#123;<span class="string">&#x27;start&#x27;</span>: <span class="number">23</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">30</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;vlog日常&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1607783788304387</span>&#125;, &#123;<span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;美食探店&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1591486437085198</span>, <span class="string">&#x27;start&#x27;</span>: <span class="number">31</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">36</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>&#125;, &#123;<span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;火锅&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1553400994340865</span>, <span class="string">&#x27;start&#x27;</span>: <span class="number">37</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">40</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>&#125;, &#123;<span class="string">&#x27;start&#x27;</span>: <span class="number">41</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">46</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;深夜放毒&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1558567968378882</span>&#125;, &#123;<span class="string">&#x27;hashtag_name&#x27;</span>: <span class="string">&#x27;美食趣胃计划&#x27;</span>, <span class="string">&#x27;hashtag_id&#x27;</span>: <span class="number">1657693004378126</span>, <span class="string">&#x27;start&#x27;</span>: <span class="number">47</span>, <span class="string">&#x27;end&#x27;</span>: <span class="number">54</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">1</span>&#125;], <span class="string">&#x27;aweme_type&#x27;</span>: <span class="number">4</span>, <span class="string">&#x27;long_video&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;music&#x27;</span>: &#123;<span class="string">&#x27;cover_medium&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;720x720/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p9.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;cover_thumb&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;168x168/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p5-ipv6.douyinpic.com/img/20b7b00015cd04a8ec0cb~c5_168x168.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/img/20b7b00015cd04a8ec0cb~c5_168x168.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p9.douyinpic.com/img/20b7b00015cd04a8ec0cb~c5_168x168.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;play_url&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;https://sf6-cdn-tos.douyinstatic.com/obj/ies-music/6942073506247379719.mp3&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://sf6-cdn-tos.douyinstatic.com/obj/ies-music/6942073506247379719.mp3&#x27;</span>, <span class="string">&#x27;https://sf3-cdn-tos.douyinstatic.com/obj/ies-music/6942073506247379719.mp3&#x27;</span>]&#125;, <span class="string">&#x27;duration&#x27;</span>: <span class="number">90</span>, <span class="string">&#x27;position&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;mid&#x27;</span>: <span class="string">&#x27;6942073520700607269&#x27;</span>, <span class="string">&#x27;title&#x27;</span>: <span class="string">&#x27;@帅气的悉尼小猪猪创作的原声&#x27;</span>, <span class="string">&#x27;cover_hd&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;1080x1080/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p26.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p29.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;cover_large&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;1080x1080/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p26.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p29.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>, <span class="string">&#x27;https://p11.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2563711402&#x27;</span>]&#125;, <span class="string">&#x27;status&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;id&#x27;</span>: <span class="number">6942073520700607000</span>, <span class="string">&#x27;author&#x27;</span>: <span class="string">&#x27;帅气的悉尼小猪猪&#x27;</span>&#125;, <span class="string">&#x27;duration&#x27;</span>: <span class="number">90139</span>, <span class="string">&#x27;risk_infos&#x27;</span>: &#123;<span class="string">&#x27;warn&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;content&#x27;</span>: <span class="string">&#x27;&#x27;</span>&#125;, <span class="string">&#x27;comment_list&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;anchor_info&#x27;</span>: &#123;<span class="string">&#x27;id&#x27;</span>: <span class="string">&#x27;6867104903072860167&#x27;</span>, <span class="string">&#x27;type&#x27;</span>: <span class="number">2</span>&#125;, <span class="string">&#x27;statistics&#x27;</span>: &#123;<span class="string">&#x27;aweme_id&#x27;</span>: <span class="string">&#x27;6942073391922842894&#x27;</span>, <span class="string">&#x27;comment_count&#x27;</span>: <span class="number">15234</span>, <span class="string">&#x27;digg_count&#x27;</span>: <span class="number">149138</span>, <span class="string">&#x27;play_count&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;share_count&#x27;</span>: <span class="number">4860</span>&#125;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">wipe_watermark</span>(<span class="params">item_info: <span class="built_in">dict</span></span>) -&gt; str:</span></span><br><span class="line">    video_url = item_info[<span class="string">&#x27;video&#x27;</span>][<span class="string">&#x27;play_addr&#x27;</span>][<span class="string">&#x27;url_list&#x27;</span>][<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(video_url).replace(<span class="string">&quot;/v1/playwm/?&quot;</span>, <span class="string">&quot;/v1/play/?&quot;</span>)</span><br><span class="line"></span><br><span class="line">print(wipe_watermark(item_info=info))</span><br></pre></td></tr></table></figure><h1 id="抖音作者信息"><a href="#抖音作者信息" class="headerlink" title="抖音作者信息"></a>抖音作者信息</h1><h2 id="接口分析-2"><a href="#接口分析-2" class="headerlink" title="接口分析"></a>接口分析</h2><p>作者信息和作品信息类似，通过客户端拿到分享链接，打开调试模式获取真实接口地址</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">分享链接：https:&#x2F;&#x2F;v.douyin.com&#x2F;eNAud7S&#x2F;</span><br><span class="line">重定向链接：https:&#x2F;&#x2F;www.iesdouyin.com&#x2F;share&#x2F;user&#x2F;76615500441?u_code&#x3D;19i75j4k2a8c&amp;did&#x3D;2471341373012760&amp;iid&#x3D;1407810874127151&amp;sec_uid&#x3D;MS4wLjABAAAAdeyz1L3UsIm98XsqJyB8DGRgqG_lRWApIECVDSnFQYE&amp;app&#x3D;aweme&amp;utm_campaign&#x3D;client_share&amp;utm_medium&#x3D;ios&amp;tt_from&#x3D;copy&amp;utm_source&#x3D;copy</span><br><span class="line">数据接口地址：https:&#x2F;&#x2F;www.iesdouyin.com&#x2F;web&#x2F;api&#x2F;v2&#x2F;user&#x2F;info&#x2F;?sec_uid&#x3D;MS4wLjABAAAAdeyz1L3UsIm98XsqJyB8DGRgqG_lRWApIECVDSnFQYE</span><br></pre></td></tr></table></figure><p>经测试，重定向后的地址参数只有sec_uid是有用的，甚至url结尾的用户ID都是没用的，例如以下两个链接返回的都是相同的信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;www.iesdouyin.com&#x2F;share&#x2F;user&#x2F;76615500441?sec_uid&#x3D;MS4wLjABAAAAdeyz1L3UsIm98XsqJyB8DGRgqG_lRWApIECVDSnFQYE</span><br><span class="line">https:&#x2F;&#x2F;www.iesdouyin.com&#x2F;share&#x2F;user&#x2F;我是帅哥?sec_uid&#x3D;MS4wLjABAAAAdeyz1L3UsIm98XsqJyB8DGRgqG_lRWApIECVDSnFQYE</span><br></pre></td></tr></table></figure><p>虽然能理解接口逻辑，但是这种操作还是蛮奇怪的。那为什么不干脆直接去掉后面的ID呢。😳</p><p>信息收集的差不多了，整理一下：</p><ol><li>获取分享链接</li><li>访问分享链接</li><li>通过重定向后的分享链接获取用户的sec_uid</li><li>调用API接口，获取作者信息</li></ol><p>逻辑和获取作品信息的非常非常像了，只不过用户无法直接通过id获取数据，猜想是因为ID是数字，容易被爬虫递增爬取。</p><h2 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭烦人提示</span></span><br><span class="line">requests.packages.urllib3.disable_warnings()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_share_content</span>(<span class="params">share_content: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    从App端分享信息中提取分享短链接</span></span><br><span class="line"><span class="string">    :param share_content:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    url_regular = re.<span class="built_in">compile</span>(<span class="string">r&quot;(https|http)?:\/\/(([0-9]&#123;1,3&#125;\.)&#123;3&#125;[0-9]&#123;1,3&#125;|([0-9a-zA-Z_!~*&#x27;()-]+\.)*([0-9a-zA-Z]&quot;</span></span><br><span class="line">                             <span class="string">r&quot;[0-9a-zA-Z-]&#123;0,61&#125;)?[0-9a-zA-Z]\.[0-9a-zA-Z]&#123;2,6&#125;)(:[0-9a-zA-Z]&#123;1,4&#125;)?&quot;</span></span><br><span class="line">                             <span class="string">r&quot;((\/[0-9a-zA-Z_!~*().;?:@&amp;=+$,%#-]*)+)?&quot;</span>)</span><br><span class="line">    result = url_regular.search(share_content)</span><br><span class="line">    <span class="keyword">if</span> result:</span><br><span class="line">        <span class="comment"># 重复判断一次，防止提取错误</span></span><br><span class="line">        <span class="keyword">if</span> result.group(<span class="number">0</span>) <span class="keyword">in</span> share_content:</span><br><span class="line">            <span class="keyword">return</span> result.group(<span class="number">0</span>).strip()</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;请输入标准的抖音分享信息&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;请输入标准的抖音分享信息&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">resolve_share_url</span>(<span class="params">share_url: <span class="built_in">str</span></span>) -&gt; str:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    解析分享链接，提取用户sec_uid</span></span><br><span class="line"><span class="string">    :param share_url:</span></span><br><span class="line"><span class="string">    :return:</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    resp = requests.get(share_url, verify=<span class="literal">False</span>)</span><br><span class="line">    <span class="comment"># url解码</span></span><br><span class="line">    url_data = parse.unquote(resp.url)</span><br><span class="line">    <span class="comment"># url结果</span></span><br><span class="line">    result = parse.urlparse(url_data)</span><br><span class="line">    <span class="comment"># url里的查询参数</span></span><br><span class="line">    query_dict = parse.parse_qs(result.query)</span><br><span class="line">    sec_uid = query_dict.get(<span class="string">&#x27;sec_uid&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> sec_uid:</span><br><span class="line">        <span class="keyword">return</span> sec_uid[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> ValueError(<span class="string">&#x27;获取作者ID异常，请检查连接：%s是否为抖音分享链接。&#x27;</span> % share_url)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_tiktok_user_info</span>(<span class="params">share_content: <span class="built_in">str</span></span>) -&gt; dict:</span></span><br><span class="line">    share_url = handle_share_content(share_content)</span><br><span class="line">    sec_uid = resolve_share_url(share_url)</span><br><span class="line">    response = requests.get(<span class="string">&quot;https://www.iesdouyin.com/web/api/v2/user/info/&quot;</span>,</span><br><span class="line">                                params=&#123;<span class="string">&#x27;sec_uid&#x27;</span>: sec_uid&#125;, verify=<span class="literal">False</span>, timeout=<span class="number">5</span>).json()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> response[<span class="string">&#x27;status_code&#x27;</span>] == <span class="number">0</span> <span class="keyword">and</span> <span class="string">&#x27;user_info&#x27;</span> <span class="keyword">in</span> response:</span><br><span class="line">        <span class="keyword">return</span> response[<span class="string">&#x27;user_info&#x27;</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="comment"># 数据不存在</span></span><br><span class="line">        <span class="keyword">raise</span> RuntimeError(<span class="string">&#x27;获取抖音Api数据失败，%s&#x27;</span> % response)</span><br><span class="line"></span><br><span class="line">data = <span class="string">&#x27;https://v.douyin.com/eNAud7S/&#x27;</span></span><br><span class="line"></span><br><span class="line">info = get_tiktok_user_info(share_content=data)</span><br><span class="line">print(info)</span><br><span class="line"></span><br><span class="line"><span class="comment">### OutPut</span></span><br><span class="line">&#123;<span class="string">&#x27;follower_count&#x27;</span>: <span class="number">6027000</span>, <span class="string">&#x27;unique_id&#x27;</span>: <span class="string">&#x27;xiaozhuzhu2334&#x27;</span>, <span class="string">&#x27;platform_sync_info&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;geofencing&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;signature&#x27;</span>: <span class="string">&#x27;🧣同名\n合作：taozi484520（只接星图）&#x27;</span>, <span class="string">&#x27;aweme_count&#x27;</span>: <span class="number">210</span>, <span class="string">&#x27;nickname&#x27;</span>: <span class="string">&#x27;帅气的悉尼小猪猪&#x27;</span>, <span class="string">&#x27;avatar_medium&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;720x720/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p11.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2956013662&#x27;</span>, <span class="string">&#x27;https://p5-ipv6.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2956013662&#x27;</span>, <span class="string">&#x27;https://p3.douyinpic.com/aweme/720x720/20b7b00015cd04a8ec0cb.jpeg?from=2956013662&#x27;</span>]&#125;, <span class="string">&#x27;verification_type&#x27;</span>: <span class="number">1</span>, <span class="string">&#x27;region&#x27;</span>: <span class="string">&#x27;CN&#x27;</span>, <span class="string">&#x27;uid&#x27;</span>: <span class="string">&#x27;76615500441&#x27;</span>, <span class="string">&#x27;short_id&#x27;</span>: <span class="string">&#x27;2262937117&#x27;</span>, <span class="string">&#x27;following_count&#x27;</span>: <span class="number">2</span>, <span class="string">&#x27;favoriting_count&#x27;</span>: <span class="number">481</span>, <span class="string">&#x27;total_favorited&#x27;</span>: <span class="string">&#x27;92187000&#x27;</span>, <span class="string">&#x27;original_musician&#x27;</span>: &#123;<span class="string">&#x27;music_count&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;music_used_count&#x27;</span>: <span class="number">0</span>&#125;, <span class="string">&#x27;secret&#x27;</span>: <span class="number">0</span>, <span class="string">&#x27;is_gov_media_vip&#x27;</span>: <span class="literal">False</span>, <span class="string">&#x27;avatar_larger&#x27;</span>: &#123;<span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;1080x1080/20b7b00015cd04a8ec0cb&#x27;</span>, <span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p29.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2956013662&#x27;</span>, <span class="string">&#x27;https://p5-ipv6.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2956013662&#x27;</span>, <span class="string">&#x27;https://p9.douyinpic.com/aweme/1080x1080/20b7b00015cd04a8ec0cb.jpeg?from=2956013662&#x27;</span>]&#125;, <span class="string">&#x27;avatar_thumb&#x27;</span>: &#123;<span class="string">&#x27;url_list&#x27;</span>: [<span class="string">&#x27;https://p29.douyinpic.com/aweme/100x100/20b7b00015cd04a8ec0cb.jpeg?from=2956013662&#x27;</span>, <span class="string">&#x27;https://p26.douyinpic.com/aweme/100x100/20b7b00015cd04a8ec0cb.jpeg?from=2956013662&#x27;</span>, <span class="string">&#x27;https://p5-ipv6.douyinpic.com/aweme/100x100/20b7b00015cd04a8ec0cb.jpeg?from=2956013662&#x27;</span>], <span class="string">&#x27;uri&#x27;</span>: <span class="string">&#x27;100x100/20b7b00015cd04a8ec0cb&#x27;</span>&#125;, <span class="string">&#x27;policy_version&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;type_label&#x27;</span>: <span class="literal">None</span>, <span class="string">&#x27;custom_verify&#x27;</span>: <span class="string">&#x27;&#x27;</span>, <span class="string">&#x27;followers_detail&#x27;</span>: <span class="literal">None</span>&#125;</span><br></pre></td></tr></table></figure><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>总体看来，抖音的数据还是非常容易爬取的，接口逻辑非常清晰简单。有机会的话后面聊一聊小红书，小红书的反爬做的是非常厉害。</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 技术 </tag>
            
            <tag> 爬虫 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Hexo博客问题整理</title>
      <link href="2021/blog-deploy/"/>
      <url>2021/blog-deploy/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>本文记录了博客折腾的大致步骤以及踩坑，先上流程架构图</p><div align="center">    <img src='https://cdn.lucat.fun/blog/2021-03/jiagou-yveWFw.jpg-w' alt='架构' width="80%"/></div><h2 id="结构说明"><a href="#结构说明" class="headerlink" title="结构说明"></a>结构说明</h2><div class="note info simple"><p>注意，涉及到两个代码仓库。<br>1，我们博客的源代码，也就是你写的Markdown源文件。<br>2，编译后，发布的Github仓库，也就是Github pages仓库</p></div><p>大体流程为：</p><ol><li>自己在本地编辑器安装hexo环境，选择主题，编写博客。</li><li>完成后执行git push推送至Github博客源码仓库。</li><li>根据配置的github workflow，触发Github Action，执行编译构建，最后使用插件hexo-deployer-git发布至Github Pages仓库，完成更新。</li><li>配置Github Pages的自定义域名，将个人域名CNAME到Github Pages的域名上。</li></ol><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>Git和Github还有Github Action，Github Pages分别是什么？</span></div>    <div class="hide-content"><ul><li><p>Git是什么<br>如果你不懂git，那么可以想象一个word文件，你的每次修改都会保存一份快照。这样有问题就可以随时回退到某个保存的节点，而git是针对一个项目所有文件的快照。<br>使用git可以做到你误删文件后可以随时恢复，修改文件后可以随时回退。<a href="https://www.liaoxuefeng.com/wiki/896043488029600">更多详情</a></p></li><li><p>Github是什么</p><div style="background:#000000; color:#000000;display: inline-block;">全球最大的同性交友网站</div>，github允许你把自己的git仓库存放到他的网站，这样你从任何可以联网的地方都可以访问自己的仓库，并且它还提供更多的功能。详情你可以查看他的官网。、</li><li><p>Github Action是什么<br>Github Action是Github推出的一项付费服务，普通用户每个月有一定的免费额度。简单来说就是可以预定一些事件，并指定什么时候运行。例如可以设定当你执行Push推送的时候，自动执行某些操作。<br>在此文章中，正是利用了Push的触发操作，执行发布更新。</p></li><li><p>Github Pages是什么<br>Github Pages是Github推出的一项免费服务，允许你发布一些静态页面。可以简单理解为你把网站给它然后由它替你发布，Free。我们正是利用了这一点，将博客编译好的成果直接放置在Github Pages上，从而白嫖。</p></li></ul></div></div><h1 id="整体流程"><a href="#整体流程" class="headerlink" title="整体流程"></a>整体流程</h1><div class="note info simple"><p>此文章并非小白从零开始教程，后续阅读将视为你已拥有：</p><ul><li>基本的操作系统知识</li><li>git环境</li><li>node环境</li></ul></div><h2 id="验证环境"><a href="#验证环境" class="headerlink" title="验证环境"></a>验证环境</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@liyao ~]<span class="comment"># git version</span></span><br><span class="line">git version 1.8.3.1</span><br><span class="line">[root@liyao ~]<span class="comment"># node -v</span></span><br><span class="line">v12.16.1</span><br><span class="line">[root@liyao ~]<span class="comment"># npm -v</span></span><br><span class="line">6.13.4</span><br></pre></td></tr></table></figure><h2 id="安装初始化hexo"><a href="#安装初始化hexo" class="headerlink" title="安装初始化hexo"></a>安装初始化hexo</h2><p>如果你不是root用户，需要使用sudo提权</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@liyao ~]<span class="comment"># sudo npm install -g hexo-cli</span></span><br><span class="line">[root@liyao ~]<span class="comment"># cd ~ #切换到你的目录</span></span><br><span class="line">[root@liyao ~]<span class="comment"># hexo init blog #blog为项目名，你可以自由替换</span></span><br><span class="line">[root@liyao ~]<span class="comment"># cd blog</span></span><br><span class="line">[root@liyao ~]<span class="comment"># npm install</span></span><br></pre></td></tr></table></figure><h2 id="安装butterfly主题"><a href="#安装butterfly主题" class="headerlink" title="安装butterfly主题"></a>安装butterfly主题</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 克隆主题代码</span></span><br><span class="line">git submodule add https://github.com/jerryc127/hexo-theme-butterfly themes/butterfly</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装主题依赖</span></span><br><span class="line">npm install hexo-renderer-pug hexo-renderer-stylus --save</span><br><span class="line"><span class="comment"># 安装部署git插件</span></span><br><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure><p>以子模块的方式引用主题的仓库，好处是管理方便，因为两个仓库独立，你可以轻松的配置两个仓库而不互相冲突。更新主题只要cd到主题目录，执行以下<code>git pull</code>即可。</p><p>但缺点是，因为github action一直沿用最新的主题master分支，一旦主题有不兼容的措施或者配置变动，可能会受到影响，需要使用者互相权衡。</p><h2 id="配置博客"><a href="#配置博客" class="headerlink" title="配置博客"></a>配置博客</h2><p>修改hexo配置文件<code>_confog.yml</code>，以下是我用到的项，按需修改。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">LiYao&#x27;s</span> <span class="string">Blog</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&quot;生于尘埃，溺于人海，死于理想高台。&quot;</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">Li</span> <span class="string">Yao</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://blog.lucat.fun</span></span><br><span class="line"></span><br><span class="line"><span class="attr">theme:</span> <span class="string">butterfly</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:liyao2598330/liyao2598330.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>生成主题配置文件，后续修改都将在主题配置文件<code>_config.butterfly.yml</code>中进行</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 复制主题配置文件，其实就是复制一份</span></span><br><span class="line">cp _config.yml _config.butterfly.yml</span><br></pre></td></tr></table></figure><p>后续详细配置你可以查看<a href="https://butterfly.js.org/posts/4aa8abbe/">官方博客</a> ，写的非常非常详细。</p><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>我的配置</span></div>    <div class="hide-content"><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Hexo Configuration</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/configuration.html</span></span><br><span class="line"><span class="comment">## Source: https://github.com/hexojs/hexo/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Site</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">LiYao&#x27;s</span> <span class="string">Blog</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">&quot;生于尘埃，溺于人海，死于理想高台。&quot;</span></span><br><span class="line"><span class="attr">keywords:</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">Li</span> <span class="string">Yao</span></span><br><span class="line"><span class="attr">language:</span> <span class="string">zh-CN</span></span><br><span class="line"><span class="attr">timezone:</span> <span class="string">Asia/Shanghai</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># URL</span></span><br><span class="line"><span class="comment">## Set your site url here. For example, if you use GitHub Page, set url as &#x27;https://username.github.io/project&#x27;</span></span><br><span class="line"><span class="attr">url:</span> <span class="string">https://blog.lucat.fun</span></span><br><span class="line"><span class="attr">permalink:</span> <span class="string">:title/</span></span><br><span class="line"><span class="attr">permalink_defaults:</span></span><br><span class="line"><span class="attr">pretty_urls:</span></span><br><span class="line">  <span class="attr">trailing_index:</span> <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;index.html&#x27; from permalinks</span></span><br><span class="line">  <span class="attr">trailing_html:</span> <span class="literal">true</span> <span class="comment"># Set to false to remove trailing &#x27;.html&#x27; from permalinks</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory</span></span><br><span class="line"><span class="attr">source_dir:</span> <span class="string">source</span></span><br><span class="line"><span class="attr">public_dir:</span> <span class="string">public</span></span><br><span class="line"><span class="attr">tag_dir:</span> <span class="string">tags</span></span><br><span class="line"><span class="attr">archive_dir:</span> <span class="string">archives</span></span><br><span class="line"><span class="attr">category_dir:</span> <span class="string">categories</span></span><br><span class="line"><span class="attr">code_dir:</span> <span class="string">downloads/code</span></span><br><span class="line"><span class="attr">i18n_dir:</span> <span class="string">:lang</span></span><br><span class="line"><span class="attr">skip_render:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Writing</span></span><br><span class="line"><span class="attr">new_post_name:</span> <span class="string">:title.md</span> <span class="comment"># File name of new posts</span></span><br><span class="line"><span class="attr">default_layout:</span> <span class="string">post</span></span><br><span class="line"><span class="attr">titlecase:</span> <span class="literal">false</span> <span class="comment"># Transform title into titlecase</span></span><br><span class="line"><span class="attr">external_link:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span> <span class="comment"># Open external links in new tab</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># Apply to the whole site</span></span><br><span class="line">  <span class="attr">exclude:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="attr">filename_case:</span> <span class="number">0</span></span><br><span class="line"><span class="attr">render_drafts:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">post_asset_folder:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">relative_link:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">future:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">highlight:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">auto_detect:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">tab_replace:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">wrap:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hljs:</span> <span class="literal">false</span></span><br><span class="line"><span class="attr">prismjs:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">preprocess:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">line_number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">tab_replace:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Home page setting</span></span><br><span class="line"><span class="comment"># path: Root path for your blogs index page. (default = &#x27;&#x27;)</span></span><br><span class="line"><span class="comment"># per_page: Posts displayed per page. (0 = disable pagination)</span></span><br><span class="line"><span class="comment"># order_by: Posts order. (Order by date descending by default)</span></span><br><span class="line"><span class="attr">index_generator:</span></span><br><span class="line">  <span class="attr">path:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">  <span class="attr">per_page:</span> <span class="number">10</span></span><br><span class="line">  <span class="attr">order_by:</span> <span class="string">-date</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Category &amp; Tag</span></span><br><span class="line"><span class="attr">default_category:</span> <span class="string">uncategorized</span></span><br><span class="line"><span class="attr">category_map:</span></span><br><span class="line"><span class="attr">tag_map:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Metadata elements</span></span><br><span class="line"><span class="comment">## https://developer.mozilla.org/en-US/docs/Web/HTML/Element/meta</span></span><br><span class="line"><span class="attr">meta_generator:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Date / Time format</span></span><br><span class="line"><span class="comment">## Hexo uses Moment.js to parse and display date</span></span><br><span class="line"><span class="comment">## You can customize the date format as defined in</span></span><br><span class="line"><span class="comment">## http://momentjs.com/docs/#/displaying/format/</span></span><br><span class="line"><span class="attr">date_format:</span> <span class="string">YYYY-MM-DD</span></span><br><span class="line"><span class="attr">time_format:</span> <span class="string">HH:mm:ss</span></span><br><span class="line"><span class="comment">## updated_option supports &#x27;mtime&#x27;, &#x27;date&#x27;, &#x27;empty&#x27;</span></span><br><span class="line"><span class="attr">updated_option:</span> <span class="string">&#x27;mtime&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Pagination</span></span><br><span class="line"><span class="comment">## Set per_page to 0 to disable pagination</span></span><br><span class="line"><span class="attr">per_page:</span> <span class="number">10</span></span><br><span class="line"><span class="attr">pagination_dir:</span> <span class="string">page</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Include / Exclude file(s)</span></span><br><span class="line"><span class="comment">## include:/exclude: options only apply to the &#x27;source/&#x27; folder</span></span><br><span class="line"><span class="attr">include:</span></span><br><span class="line"><span class="attr">exclude:</span></span><br><span class="line"><span class="attr">ignore:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Extensions</span></span><br><span class="line"><span class="comment">## Plugins: https://hexo.io/plugins/</span></span><br><span class="line"><span class="comment">## Themes: https://hexo.io/themes/</span></span><br><span class="line"><span class="attr">theme:</span> <span class="string">butterfly</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: https://hexo.io/docs/one-command-deployment</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">repository:</span> <span class="string">git@github.com:liyao2598330/liyao2598330.github.io.git</span></span><br><span class="line">  <span class="attr">branch:</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主题配置 https://butterfly.js.org/posts/4aa8abbe/</span></span><br><span class="line"><span class="comment">## 首页菜单</span></span><br><span class="line"><span class="attr">menu:</span></span><br><span class="line">  <span class="string">首頁:</span> <span class="string">/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-home</span></span><br><span class="line">  <span class="string">时间轴:</span> <span class="string">/archives/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-archive</span></span><br><span class="line">  <span class="string">标签:</span> <span class="string">/tags/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-tags</span></span><br><span class="line">  <span class="string">分类:</span> <span class="string">/categories/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-folder-open</span></span><br><span class="line">  <span class="string">友链:</span> <span class="string">/link/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-link</span></span><br><span class="line">  <span class="string">关于||fas</span> <span class="attr">fa-heart:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">我</span> <span class="string">||</span> <span class="string">/about/</span> <span class="string">||</span> <span class="string">fas</span> <span class="string">fa-user</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 代码配置</span></span><br><span class="line"><span class="attr">highlight_theme:</span> <span class="string">darker</span></span><br><span class="line"><span class="attr">highlight_copy:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">highlight_shrink:</span> <span class="string">none</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 社交配置</span></span><br><span class="line"><span class="attr">social:</span></span><br><span class="line">  <span class="attr">fab fa-github:</span> <span class="string">https://github.com/liyao2598330</span> <span class="string">||</span> <span class="string">Github</span></span><br><span class="line">  <span class="attr">fas fa-envelope:</span> <span class="string">mailto:liyao2598330@gmail.com</span> <span class="string">||</span> <span class="string">Email</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章节选配置</span></span><br><span class="line"><span class="attr">index_post_content:</span></span><br><span class="line">  <span class="attr">method:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">length:</span> <span class="number">200</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 网站顶部图</span></span><br><span class="line"><span class="attr">index_img:</span> <span class="string">&#x27;https://cdn.lucat.fun/blog/2021-03/bg-55TvGD.jpg&#x27;</span></span><br><span class="line"><span class="attr">default_top_img:</span> <span class="string">&#x27;linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)&#x27;</span></span><br><span class="line"><span class="attr">archive_img:</span> <span class="string">&#x27;linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)&#x27;</span></span><br><span class="line"><span class="string">tag_img</span><span class="attr">tag:</span> <span class="string">&#x27;linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)&#x27;</span></span><br><span class="line"><span class="attr">category_img:</span> <span class="string">&#x27;linear-gradient(20deg, #0062be, #925696, #cc426e, #fb0347)&#x27;</span></span><br><span class="line"><span class="attr">tag_per_img:</span></span><br><span class="line">  <span class="attr">aplayer:</span> <span class="string">https://xxxxxx.png</span></span><br><span class="line">  <span class="attr">android:</span> <span class="string">ddddddd.png</span></span><br><span class="line"></span><br><span class="line"><span class="attr">category_per_img:</span></span><br><span class="line">  <span class="string">隨想:</span> <span class="string">hdhdh.png</span></span><br><span class="line">  <span class="string">推薦:</span> <span class="string">ddjdjdjd.png</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章封面图</span></span><br><span class="line"><span class="attr">cover:</span></span><br><span class="line">  <span class="comment"># 是否顯示文章封面</span></span><br><span class="line">  <span class="attr">index_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">aside_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">archives_enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 封面顯示的位置</span></span><br><span class="line">  <span class="comment"># 三個值可配置 left , right , both</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">both</span></span><br><span class="line">  <span class="comment"># 當沒有設置cover時，默認的封面顯示</span></span><br><span class="line">  <span class="attr">default_cover:</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章展示信息</span></span><br><span class="line"><span class="attr">post_meta:</span></span><br><span class="line">  <span class="attr">page:</span></span><br><span class="line">    <span class="attr">date_type:</span> <span class="string">both</span> <span class="comment"># created or updated or both 主頁文章日期是創建日或者更新日或都顯示</span></span><br><span class="line">    <span class="attr">date_format:</span> <span class="string">relative</span> <span class="comment"># date/relative 顯示日期還是相對日期</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">true</span> <span class="comment"># true or false 主頁是否顯示分類</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">true</span> <span class="comment"># true or false 主頁是否顯示標籤</span></span><br><span class="line">    <span class="attr">label:</span> <span class="literal">true</span> <span class="comment"># true or false 顯示描述性文字</span></span><br><span class="line">  <span class="attr">post:</span></span><br><span class="line">    <span class="attr">date_type:</span> <span class="string">both</span> <span class="comment"># created or updated or both 文章頁日期是創建日或者更新日或都顯示</span></span><br><span class="line">    <span class="attr">date_format:</span> <span class="string">relative</span> <span class="comment"># date/relative 顯示日期還是相對日期</span></span><br><span class="line">    <span class="attr">categories:</span> <span class="literal">true</span> <span class="comment"># true or false 文章頁是否顯示分類</span></span><br><span class="line">    <span class="attr">tags:</span> <span class="literal">true</span> <span class="comment"># true or false 文章頁是否顯示標籤</span></span><br><span class="line">    <span class="attr">label:</span> <span class="literal">true</span> <span class="comment"># true or false 顯示描述性文字</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章版权信息</span></span><br><span class="line"><span class="attr">post_copyright:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">decode:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">license:</span> <span class="string">CC</span> <span class="string">BY-NC-SA</span> <span class="number">4.0</span></span><br><span class="line">  <span class="attr">license_url:</span> <span class="string">https://creativecommons.org/licenses/by-nc-sa/4.0/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章目录</span></span><br><span class="line"><span class="attr">toc:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">number:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">style_simple:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">related_post:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">limit:</span> <span class="number">6</span> <span class="comment"># 顯示推薦文章數目</span></span><br><span class="line">  <span class="attr">date_type:</span> <span class="string">created</span> <span class="comment"># or created or updated 文章日期顯示創建日或者更新日</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章锚点</span></span><br><span class="line"><span class="attr">anchor:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章过期提示</span></span><br><span class="line"><span class="attr">noticeOutdate:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">simple</span> <span class="comment"># style: simple/flat</span></span><br><span class="line">  <span class="attr">limit_day:</span> <span class="number">365</span> <span class="comment"># When will it be shown</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">top</span> <span class="comment"># position: top/bottom</span></span><br><span class="line">  <span class="attr">message_prev:</span> <span class="string">你似乎正在查看一篇很久远的文章，本文编写于</span></span><br><span class="line">  <span class="attr">message_next:</span> <span class="string">天前，其中某些信息可能过期</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 文章分页</span></span><br><span class="line"><span class="attr">post_pagination:</span></span><br><span class="line">  <span class="attr">value:</span> <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 头像</span></span><br><span class="line"><span class="attr">avatar:</span></span><br><span class="line">  <span class="attr">img:</span> <span class="string">/image/avatar.jpg</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 复制提示</span></span><br><span class="line"><span class="attr">copy:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">copyright:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit_count:</span> <span class="number">50</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 页脚</span></span><br><span class="line"><span class="attr">footer:</span></span><br><span class="line">  <span class="attr">owner:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">since:</span> <span class="number">2018</span></span><br><span class="line">  <span class="attr">custom_text:</span> <span class="comment"># 你的自定义信息</span></span><br><span class="line"></span><br><span class="line"><span class="attr">darkmode:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># dark mode和 light mode切換按鈕</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">autoChangeMode:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 网站统计</span></span><br><span class="line"><span class="attr">busuanzi:</span></span><br><span class="line">  <span class="attr">site_uv:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">site_pv:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">page_pv:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 运行时间</span></span><br><span class="line"><span class="attr">runtimeshow:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">publish_date:</span> <span class="number">2018</span><span class="string">/6/8</span> <span class="number">00</span><span class="string">:00:00</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 笔记配置</span></span><br><span class="line"><span class="attr">note:</span></span><br><span class="line">  <span class="comment"># Note tag style values:</span></span><br><span class="line">  <span class="comment">#  - simple    bs-callout old alert style. Default.</span></span><br><span class="line">  <span class="comment">#  - modern    bs-callout new (v2-v3) alert style.</span></span><br><span class="line">  <span class="comment">#  - flat      flat callout style with background, like on Mozilla or StackOverflow.</span></span><br><span class="line">  <span class="comment">#  - disabled  disable all CSS styles import of note tag.</span></span><br><span class="line">  <span class="attr">style:</span> <span class="string">simple</span></span><br><span class="line">  <span class="attr">icons:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">border_radius:</span> <span class="number">3</span></span><br><span class="line">  <span class="comment"># Offset lighter of background in % for modern and flat styles (modern: -12 | 12; flat: -18 | 6).</span></span><br><span class="line">  <span class="comment"># Offset also applied to label tag variables. This option can work with disabled note tag.</span></span><br><span class="line">  <span class="attr">light_bg_offset:</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 开启美化</span></span><br><span class="line"><span class="attr">beautify:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">field:</span> <span class="string">site</span> <span class="comment"># site/post</span></span><br><span class="line">  <span class="attr">title-prefix-icon:</span> <span class="string">&#x27;\f0c1&#x27;</span></span><br><span class="line">  <span class="attr">title-prefix-icon-color:</span> <span class="string">&quot;#F47466&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 主頁subtitle</span></span><br><span class="line"><span class="attr">subtitle:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="comment"># 打字效果</span></span><br><span class="line">  <span class="attr">effect:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 循環或者只打字一次</span></span><br><span class="line">  <span class="attr">loop:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># source調用第三方服務</span></span><br><span class="line">  <span class="comment"># source: false 關閉調用</span></span><br><span class="line">  <span class="comment"># source: 1  調用搏天api的隨機語錄（簡體）</span></span><br><span class="line">  <span class="comment"># source: 2  調用一言網的一句話（簡體）</span></span><br><span class="line">  <span class="comment"># source: 3  調用一句網（簡體）</span></span><br><span class="line">  <span class="comment"># source: 4  調用今日詩詞（簡體</span></span><br><span class="line">  <span class="comment"># subtitle 會先顯示 source , 再顯示 sub 的內容</span></span><br><span class="line">  <span class="attr">source:</span> <span class="literal">false</span></span><br><span class="line">  <span class="comment"># 如果有英文逗號&#x27; , &#x27;,請使用轉義字元 &amp;#44;</span></span><br><span class="line">  <span class="comment"># 如果有英文雙引號&#x27; &quot; &#x27;,請使用轉義字元 &amp;quot;</span></span><br><span class="line">  <span class="comment"># 開頭不允許轉義字元，如需要，請把整個句子用雙引號包住</span></span><br><span class="line">  <span class="comment"># 例如 ”&amp;quotNever put off till tomorrow what you can do today&amp;quot&quot;</span></span><br><span class="line">  <span class="comment"># 如果關閉打字效果，subtitle只會顯示sub的第一行文字</span></span><br><span class="line">  <span class="attr">sub:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;生于尘埃，溺于人海，死于理想高台。&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 图片缩放</span></span><br><span class="line"><span class="attr">fancybox:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 美化弹窗</span></span><br><span class="line"><span class="attr">snackbar:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">top-right</span></span><br><span class="line">  <span class="attr">bg_light:</span> <span class="string">&#x27;#49b1f5&#x27;</span> <span class="comment">#light mode時彈窗背景</span></span><br><span class="line">  <span class="attr">bg_dark:</span> <span class="string">&#x27;#2d3035&#x27;</span> <span class="comment">#dark mode時彈窗背景</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 分享信息</span></span><br><span class="line"><span class="attr">Open_Graph_meta:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## 预加载网页</span></span><br><span class="line"><span class="attr">instantpage:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">pjax:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">exclude:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/music/</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/no-pjax/</span></span><br><span class="line"></span><br><span class="line"><span class="attr">aside:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">hide:</span> <span class="literal">false</span></span><br><span class="line">  <span class="attr">button:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">true</span> <span class="comment"># display on mobile</span></span><br><span class="line">  <span class="attr">position:</span> <span class="string">right</span> <span class="comment"># left or right</span></span><br><span class="line">  <span class="attr">card_author:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">description:</span></span><br><span class="line">    <span class="attr">button:</span></span><br><span class="line">      <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fab</span> <span class="string">fa-github</span></span><br><span class="line">      <span class="attr">text:</span> <span class="string">Follow</span> <span class="string">Me</span></span><br><span class="line">      <span class="attr">link:</span> <span class="string">https://github.com/liyao2598330</span></span><br><span class="line">  <span class="attr">card_announcement:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">content:</span> <span class="string">新迁移博客，旧文章丢失无法恢复</span></span><br><span class="line">  <span class="attr">card_recent_post:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">5</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">sort:</span> <span class="string">date</span> <span class="comment"># date or updated</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_categories:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">expand:</span> <span class="string">none</span> <span class="comment"># none/true/false</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_tags:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">40</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">color:</span> <span class="literal">false</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_archives:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">monthly</span> <span class="comment"># yearly or monthly</span></span><br><span class="line">    <span class="attr">format:</span> <span class="string">MMMM</span> <span class="string">YYYY</span> <span class="comment"># eg: YYYY年MM月</span></span><br><span class="line">    <span class="attr">order:</span> <span class="number">-1</span> <span class="comment"># Sort of order. 1, asc for ascending; -1, desc for descending</span></span><br><span class="line">    <span class="attr">limit:</span> <span class="number">8</span> <span class="comment"># if set 0 will show all</span></span><br><span class="line">    <span class="attr">sort_order:</span> <span class="comment"># Don&#x27;t modify the setting unless you know how it works</span></span><br><span class="line">  <span class="attr">card_webinfo:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">post_count:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">last_push_date:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">error_404:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">subtitle:</span> <span class="string">&quot;页面走丢了 (ಥ﹏ಥ)&quot;</span></span><br><span class="line">  <span class="attr">background:</span></span><br><span class="line"></span><br><span class="line"><span class="attr">footer_bg:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">comments:</span></span><br><span class="line">  <span class="attr">use:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">Waline</span></span><br><span class="line">  <span class="attr">lazyload:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">count:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">card_post_count:</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line"><span class="attr">waline:</span></span><br><span class="line">  <span class="attr">appId:</span>  <span class="comment"># 更换为自己的appId</span></span><br><span class="line">  <span class="attr">appKey:</span>  <span class="comment"># 更换为自己的appKey</span></span><br><span class="line">  <span class="attr">pageSize:</span> <span class="number">10</span> <span class="comment"># comment list page size</span></span><br><span class="line">  <span class="attr">serverURL:</span>  <span class="comment"># 更换为自己的serverURL</span></span><br><span class="line">  <span class="attr">avatar:</span> <span class="string">monsterid</span> <span class="comment"># gravatar style https://zh-tw.gravatar.com/site/implement/images/#default-image</span></span><br><span class="line">  <span class="attr">bg:</span> <span class="string">/image/comment_bg.png</span> <span class="comment"># 在source下建立image目录，放置背景图</span></span><br><span class="line">  <span class="attr">emojiCDN:</span> <span class="comment"># emoji CDN</span></span><br><span class="line">  <span class="attr">lang:</span> <span class="string">zh-CN</span> <span class="comment"># i18n: zh-CN/zh-TW/en/ja</span></span><br><span class="line">  <span class="attr">option:</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="attr">canvas_ribbon:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">size:</span> <span class="number">150</span></span><br><span class="line">  <span class="attr">alpha:</span> <span class="number">0.6</span></span><br><span class="line">  <span class="attr">zIndex:</span> <span class="number">-1</span></span><br><span class="line">  <span class="attr">click_to_change:</span> <span class="literal">true</span>  <span class="comment">#設置是否每次點擊都更換綵帶</span></span><br><span class="line">  <span class="attr">mobile:</span> <span class="literal">false</span> <span class="comment"># false 手機端不顯示 true 手機端顯示</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></div></div><h2 id="准备发布"><a href="#准备发布" class="headerlink" title="准备发布"></a>准备发布</h2><h3 id="创建需要的仓库"><a href="#创建需要的仓库" class="headerlink" title="创建需要的仓库"></a>创建需要的仓库</h3><ol><li>创建<code>blog</code>存放源代码</li><li>创建<code>你的GitHub用户名.github.io</code>用来存放博客</li></ol><h3 id="生成并绑定秘钥"><a href="#生成并绑定秘钥" class="headerlink" title="生成并绑定秘钥"></a>生成并绑定秘钥</h3><div class="note info simple"><p>注意，本小节生成的两个文件，带<code>.pub</code>的为公钥文件，不带的则为私钥文件，不要弄混。</p></div><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -f blog  <span class="comment"># 一直回车就好，不要输入任何东西</span></span><br></pre></td></tr></table></figure><p>打开SSH KEY配置<a href="https://github.com/settings/keys">页面</a> ，新建SSH key， 将公钥<code>blog.pub</code>的内容填入，名字自己写一个自己看的懂的就行。</p><p>打开博客源码仓库<code>blog</code>，打开设置，Secrets配置页面，创建名为<code>HEXO_DEPLOY_PRI</code>的变量，将私钥<code>blog</code>的内容填写进去</p><div align="center">    <img src='https://cdn.lucat.fun/blog/2021-03/sec-gE5N4u.png' width="80%" alt='创建部署需要的私钥信息'/></div><h3 id="创建Github-Action需要的workflow文件"><a href="#创建Github-Action需要的workflow文件" class="headerlink" title="创建Github Action需要的workflow文件"></a>创建Github Action需要的workflow文件</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 与source文件夹同级，创建文件夹</span></span><br><span class="line">mkdir -p .github/workflows</span><br><span class="line">touch .github/workflows/deploy.yml</span><br></pre></td></tr></table></figure><p><code>deploy.yaml</code>内容你可以参考下面的配置，只需修改标注的三个地方即可，其他都不用修改</p><div class="hide-toggle" ><div class="hide-button toggle-title" style=""><i class="fas fa-caret-right fa-fw"></i><span>我的配置</span></div>    <div class="hide-content"><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">CI</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">master</span></span><br><span class="line"></span><br><span class="line"><span class="attr">env:</span></span><br><span class="line">  <span class="attr">GIT_USER:</span> <span class="comment"># 你的github用户名 例如：liyao2598330</span></span><br><span class="line">  <span class="attr">GIT_EMAIL:</span> <span class="comment"># 你的github邮箱 例如: liyao2598330@126.com</span></span><br><span class="line">  <span class="attr">DEPLOY_REPO:</span> <span class="comment"># 你的博客仓库地址，以github.io结尾，例如：liyao2598330/liyao2598330.github.io</span></span><br><span class="line">  <span class="attr">DEPLOY_BRANCH:</span> <span class="string">master</span> <span class="comment"># 按需修改</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">build:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">Build</span> <span class="string">on</span> <span class="string">node</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span> <span class="string">and</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.os</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">strategy:</span></span><br><span class="line">      <span class="attr">matrix:</span></span><br><span class="line">        <span class="attr">os:</span> [<span class="string">ubuntu-latest</span>]</span><br><span class="line">        <span class="attr">node_version:</span> [<span class="number">12.</span><span class="string">x</span>]</span><br><span class="line"></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Checkout</span> <span class="string">deploy</span> <span class="string">repo</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/checkout@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">repository:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.DEPLOY_REPO</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">ref:</span> <span class="string">$&#123;&#123;</span> <span class="string">env.DEPLOY_BRANCH</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">.deploy_git</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v1</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">$&#123;&#123;</span> <span class="string">matrix.node_version</span> <span class="string">&#125;&#125;</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Configuration</span> <span class="string">environment</span></span><br><span class="line">        <span class="attr">env:</span></span><br><span class="line">          <span class="attr">HEXO_DEPLOY_PRI:</span> <span class="string">$&#123;&#123;secrets.HEXO_DEPLOY_PRI&#125;&#125;</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">sudo</span> <span class="string">timedatectl</span> <span class="string">set-timezone</span> <span class="string">&quot;Asia/Shanghai&quot;</span></span><br><span class="line">          <span class="string">mkdir</span> <span class="string">-p</span> <span class="string">~/.ssh/</span></span><br><span class="line">          <span class="string">echo</span> <span class="string">&quot;$HEXO_DEPLOY_PRI&quot;</span> <span class="string">&gt;</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">          <span class="string">chmod</span> <span class="number">600</span> <span class="string">~/.ssh/id_rsa</span></span><br><span class="line">          <span class="string">ssh-keyscan</span> <span class="string">github.com</span> <span class="string">&gt;&gt;</span> <span class="string">~/.ssh/known_hosts</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.name</span> <span class="string">$GIT_USER</span></span><br><span class="line">          <span class="string">git</span> <span class="string">config</span> <span class="string">--global</span> <span class="string">user.email</span> <span class="string">$GIT_EMAIL</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">npm</span> <span class="string">install</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Hexo</span> <span class="string">generate</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">npm</span> <span class="string">build</span></span><br><span class="line"></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">hexo</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">|</span></span><br><span class="line">          <span class="string">npm</span> <span class="string">run</span> <span class="string">deploy</span></span><br></pre></td></tr></table></figure></div></div><h3 id="执行push，验证结果"><a href="#执行push，验证结果" class="headerlink" title="执行push，验证结果"></a>执行push，验证结果</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git push</span><br></pre></td></tr></table></figure><div align="center">    <img src='https://cdn.lucat.fun/blog/2021-03/WX20210319-184249@2x-tuya-dBeYI6.png' width="80%" alt='查看Action执行结果'/></div><p>打开你的仓库地址：你的Github用户名.github.io 查看效果</p><h2 id="设置自定义域名"><a href="#设置自定义域名" class="headerlink" title="设置自定义域名"></a>设置自定义域名</h2><h3 id="配置CNAME"><a href="#配置CNAME" class="headerlink" title="配置CNAME"></a>配置CNAME</h3><p>如果你有域名，首先登陆至域名管理平台，如果你没有，可以考虑<a href="https://www.aliyun.com/purchasing/2021?userCode=edey52on">购买</a> 一个。<span class="hide-inline"><button type="button" class="hide-button button--animated" style="">无推广  </button><span class="hide-content">上面链接包括推广，不会增加你的成本，且阿里云会返给我一些代金券。无推广信息的请点这里https://www.aliyun.com/purchasing/2021</span></span></p><p>假设，我想将blog.lucat.fun自定义域名转至liyao2598330.github.io</p><p>以阿里云为例，登录控制台，做如下配置</p><div align="center">    <img src='https://cdn.lucat.fun/blog/2021-03/cname-tuya-FIGHig.png' width="80%" alt='查看Action执行结果'/></div><ul><li>类型：CNAME</li><li>主机记录：blog</li><li>记录值：你的github pages地址</li><li>ttl：无所谓，默认</li></ul><h3 id="项目下创建CNAME文件"><a href="#项目下创建CNAME文件" class="headerlink" title="项目下创建CNAME文件"></a>项目下创建CNAME文件</h3><div class="note info simple"><p>重要！不添加会导致每次自动构建会丢失CNAME配置</p></div><p>在项目source目录下，创建一个名为CNAME的文件，内容为你的github pages地址</p><h3 id="配置Github-Pages"><a href="#配置Github-Pages" class="headerlink" title="配置Github Pages"></a>配置Github Pages</h3><p>在github pages项目Settings配置下，找到相关配置</p><div align="center">    <img src='https://cdn.lucat.fun/blog/2021-03/githunpages-tuya-Mk6UvH.png' width="80%" alt='查看Action执行结果'/></div><p>修改<code>Custom domain</code>为自己刚才配置好的地址，第一次配置，github会帮你申请90天的https，最迟24小时生效。在证书生效之前，你的访问浏览器会警告提示证书不信任。</p><p>90天到期前Github会自动帮你续期，所以不用担心过期。</p>]]></content>
      
      
      <categories>
          
          <category> 技术 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 博客 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>新的开始</title>
      <link href="2021/new-start/"/>
      <url>2021/new-start/</url>
      
        <content type="html"><![CDATA[<h3 id="絮叨"><a href="#絮叨" class="headerlink" title="絮叨"></a>絮叨</h3><p>终于打算放弃了自己开发博客的念头，从一开始的满腔念想到现在，也不过用了一年的时间，也就是下图。</p><div align="center">    <img src="https://cdn.lucat.fun/blog/2021-03/a-8vcWav.png-w" width="80%"/></div><p>最开始的目的：学习Vue也达到了，目前为止手写的项目也不下五六个，虽然不敢说完全吃透，但是针对工作来说基本够用了。</p><h3 id="杂念"><a href="#杂念" class="headerlink" title="杂念"></a>杂念</h3><p>迁移后的第一件事就是对着首页发了一会呆，竭尽脑汁的想象一个不错的slogan，翻看时知乎上一句话触动我心</p><p><strong>生于尘埃，溺于人海，死于理想高台。</strong></p><p>评论下，大家对这句话是悲还是喜的讨论很多，但大部分都觉得这句话很丧。</p><div class="hide-block"><button type="button" class="hide-button button--animated" style="">而我觉得    </button><div class="hide-content"><p>而我觉得每个人都是风尘仆仆的来到世上，充满自信和理想。<br>长大的我们，身为大多数人的我们终会被埋没，也许是渐渐的，悄无声息的变为自己不曾想象的人，沉寂于生活。<br>但总有一些东西是别人无法夺舍的，无法摧毁的。它值得用生命去捍卫，那就是我们的理想和自由。</p><p>这像极了一生</p></div></div><p>而现在正在看文章的你，又是怎么想的呢？</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 杂谈 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
